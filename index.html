<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>H·ªó tr·ª£ Nh·∫≠p li·ªáu ThƒÉm kh√°m - Ph√°t tri·ªÉn H√†nh vi Nhi khoa</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/docx@8.5.0/build/index.umd.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          colors: {
            primary: { 50: '#f0f9ff', 100: '#e0f2fe', 500: '#0ea5e9', 600: '#0284c7', 700: '#0369a1' },
            accent: { 50: '#f0fdfa', 100: '#ccfbf1', 500: '#14b8a6', 600: '#0d9488' }
          },
          animation: { 'fade-in': 'fadeIn 0.2s ease-out', 'slide-up': 'slideUp 0.3s ease-out' },
          keyframes: {
            fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
            slideUp: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
          }
        }
      }
    }
  </script>
  <style>
    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: 'Inter', system-ui, sans-serif;
    }

    .icon {
      width: 1.25rem;
      height: 1.25rem;
      stroke: currentColor;
      stroke-width: 1.5;
      fill: none;
    }

    .icon-lg {
      width: 1.5rem;
      height: 1.5rem;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.2);
    }

    .animate-in {
      animation: fadeIn 0.2s ease-out;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useCallback, useMemo, memo } = React;

    /*
    ============================================================================
    C·∫§U H√åNH D·ªÆ LI·ªÜU - ANH C√ì TH·ªÇ S·ª¨A ·ªû ƒê√ÇY
    ============================================================================
    */
    const CONFIG = {
      cachSinhOptions: ['sinh th∆∞·ªùng', 'sinh m·ªï', 'sinh gi√∫p b·∫±ng k·ªÅm'],
      noiKhamOptions: ['BV Nhi ƒê·ªìng', 'Ph√≤ng kh√°m t∆∞', 'Trung t√¢m can thi·ªáp'],
      lyDoKhamOptions: ['kh√¥ng ƒë√°p ·ª©ng v·ªõi t√™n g·ªçi', 'ch·∫≠m n√≥i', 'lƒÉng xƒÉng', 'kh√¥ng ch∆°i v·ªõi b·∫°n', 'h√†nh vi b·∫•t th∆∞·ªùng'],
      chanDoanTruocOptions: ['R·ªëi lo·∫°n ph·ªï t·ª± k·ª∑', 'Theo d√µi r·ªëi lo·∫°n ph·ªï t·ª± k·ª∑', 'R·ªëi lo·∫°n ph√°t tri·ªÉn lan t·ªèa', 'R·ªëi lo·∫°n ng√¥n ng·ªØ', 'TƒÉng ƒë·ªông gi·∫£m ch√∫ √Ω'],
      songVoiOptions: ['Ba', 'M·∫π', '√îng b√† n·ªôi', '√îng b√† ngo·∫°i', 'Ng∆∞·ªùi gi√∫p vi·ªác'],
      loLangOptions: ['Ch∆∞a n√≥i, ch·∫≠m n√≥i', 'Kh√¥ng ch∆°i v·ªõi b·∫°n', 'TƒÉng ƒë·ªông', 'Kh√¥ng ƒë√°p ·ª©ng t√™n g·ªçi', 'Kh√≥ ng·ªß', 'Bi·∫øng ƒÉn', 'H√†nh vi b·∫•t th∆∞·ªùng'],
      hanhViLapLaiOptions: ['v·∫´y tay', 'nh√≥n ch√¢n', 'xoay tr√≤n ƒë·ªì v·∫≠t', 'xoay ng∆∞·ªùi', 'nh·∫°i l·ªùi', 'x·∫øp ƒë·ªì theo h√†ng th·∫≥ng'],
      bamViuThoiQuenOptions: ['ch·ªëng ƒë·ªëi ho·∫∑c ho·∫£ng lo·∫°n khi thay ƒë·ªïi l·ªãch tr√¨nh', 'ch·ªëng ƒë·ªëi ho·∫∑c ho·∫£ng lo·∫°n khi thay ƒë·ªïi th√≥i quen', 'ƒÉn u·ªëng theo c√°ch nh·∫•t ƒë·ªãnh', 'm·∫∑c qu·∫ßn √°o theo c√°ch nh·∫•t ƒë·ªãnh'],
      soThichHanCheOptions: ['m√™ xe', 'm√™ c√°c con s·ªë', 'm√™ n·∫Øp chai', 'bi·∫øt ƒë·ªçc v∆∞·ª£t tr·ªôi so v·ªõi b·∫°n c√πng tu·ªïi', 'l√†m to√°n v∆∞·ª£t tr·ªôi so v·ªõi b·∫°n c√πng tu·ªïi', 'n√≥i ƒëi n√≥i l·∫°i m·ªôt ch·ªß ƒë·ªÅ ∆∞a th√≠ch'],
      phanUngGiacQuanOptions: ['b·ªãt tai v·ªõi ti·∫øng m√°y xay sinh t·ªë', 'ng·ª≠i ƒë·ªì v·∫≠t', 'li·∫øm ƒë·ªì v·∫≠t', 'ch·ªãu ƒëau t·ªët h∆°n h·∫≥n so v·ªõi b·∫°n kh√°c', 'ch·ªãu l·∫°nh t·ªët h∆°n h·∫≥n so v·ªõi b·∫°n kh√°c'],
      hanhViKhamOptions: ['y√™n', 'lƒÉng xƒÉng, th∆∞·ªùng ch·∫°y ho·∫∑c ƒëi ƒëi l·∫°i l·∫°i trong ph√≤ng kh√°m', 'ƒëi nh√≥n ch√¢n'],
      choiDoChoiKhamOptions: ['ng·∫≠m', 'li·∫øm', 'ng·ª≠i', 'nh√¨n chƒÉm ch√∫ chi ti·∫øt ƒë·ªì ch∆°i'],
      khamHanhViBatThuongOptions: ['ƒëi nh√≥n ch√¢n', 'v·∫´y tay', 'l·∫Øc ƒë·∫ßu', 'nh√¨n chƒÉm ch√∫ b√°nh xe', 'ng·∫≠m ƒë·ªì ch∆°i'],
      chanDoanOptions: ['R·ªëi lo·∫°n ph·ªï t·ª± k·ª∑', 'R·ªëi lo·∫°n tƒÉng ƒë·ªông k√©m ch√∫ √Ω', 'R·ªëi lo·∫°n ng√¥n ng·ªØ', 'Ch·∫≠m ph√°t tri·ªÉn to√†n di·ªán', 'Ch·∫≠m ph√°t tri·ªÉn ng√¥n ng·ªØ', 'R·ªëi lo·∫°n ph√°t tri·ªÉn tr√≠ tu·ªá'],
      huongDanPHOptions: ['ti·∫øp x√∫c m·∫Øt', 'ch√∫ √Ω li√™n k·∫øt', 'ch·ªâ ng√≥n tr·ªè', 'ch∆°i lu√¢n phi√™n', 'b·∫Øt ch∆∞·ªõc h√†nh ƒë·ªông', 'b·∫Øt ch∆∞·ªõc √¢m thanh'],
      taiKhamOptions: ['sau 1 th√°ng', 'sau 3 th√°ng', 'sau 3 - 6 th√°ng'],
      khamThemChuyenKhoaOptions: ['Tai m≈©i h·ªçng', 'Th·∫ßn kinh', 'M·∫Øt', 'Di truy·ªÅn', 'N·ªôi ti·∫øt', 'T√¢m l√Ω'],
      mucDoTriTueOptions: ['ch·∫≠m ph√°t tri·ªÉn', 'ranh gi·ªõi gi·ªØa trung b√¨nh th·∫•p v√† ch·∫≠m ph√°t tri·ªÉn', 'trung b√¨nh th·∫•p', 'trung b√¨nh', 'cao'],
      mucDoTriTueWISCOptions: ['ch·∫≠m ph√°t tri·ªÉn m·ª©c ƒë·ªô nh·∫π', 'ch·∫≠m ph√°t tri·ªÉn m·ª©c ƒë·ªô trung b√¨nh', 'ch·∫≠m ph√°t tri·ªÉn m·ª©c ƒë·ªô n·∫∑ng', 'ranh gi·ªõi gi·ªØa trung b√¨nh th·∫•p v√† ch·∫≠m ph√°t tri·ªÉn', 'trung b√¨nh th·∫•p', 'trung b√¨nh', 'cao'],
      danhGiaKhiTuChoiOptions: ['ch∆°i m·ªôt m√¨nh to√†n b·ªô th·ªùi gian', 'ch∆°i m·ªôt m√¨nh th·ªânh tho·∫£ng c√≥ y√™u c·∫ßu ng∆∞·ªùi chƒÉm s√≥c h·ªó tr·ª£', 'ch·ªß ƒë·ªông m·ªùi ng∆∞·ªùi chƒÉm s√≥c ch∆°i, khoe v√† g√¢y ch√∫ √Ω v·ªõi ng∆∞·ªùi chƒÉm s√≥c'],
    };

    /*
    ============================================================================
    C√ÅC COMPONENT UI C∆† B·∫¢N
    ============================================================================
    */

    const InputField = memo(({ label, value, fieldKey, updateField, placeholder, suffix, className = '' }) => {
      const handleChange = useCallback((e) => {
        updateField(fieldKey, e.target.value);
      }, [fieldKey, updateField]);

      return (
        <div className={`inline-flex items-center gap-2 flex-wrap ${className}`}>
          {label && <label className="text-slate-600 whitespace-nowrap">{label}</label>}
          <input
            type="text"
            value={value || ''}
            onChange={handleChange}
            placeholder={placeholder}
            className="px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 focus:border-teal-500 outline-none bg-white min-w-[80px]"
            autoComplete="off"
          />
          {suffix && <span className="text-slate-600 whitespace-nowrap">{suffix}</span>}
        </div>
      );
    });

    const CheckboxGroup = memo(({ options, selected = [], fieldKey, updateField, columns = 2, selectAllLabel }) => {
      const allSelected = options.length > 0 && options.every(opt => selected.includes(opt));

      const handleSelectAll = useCallback(() => {
        updateField(fieldKey, allSelected ? [] : [...options]);
      }, [fieldKey, updateField, allSelected, options]);

      const handleChange = useCallback((option, checked) => {
        if (checked) {
          updateField(fieldKey, [...selected, option]);
        } else {
          updateField(fieldKey, selected.filter(o => o !== option));
        }
      }, [fieldKey, updateField, selected]);

      return (
        <div>
          {selectAllLabel && (
            <label className="flex items-center gap-2 px-3 py-2 mb-2 rounded-lg border-2 border-dashed border-teal-300 bg-teal-50 cursor-pointer hover:bg-teal-100 transition-all">
              <input type="checkbox" checked={allSelected} onChange={handleSelectAll} className="w-4 h-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500" />
              <span className="text-sm font-medium text-teal-700">{selectAllLabel}</span>
            </label>
          )}
          <div className="grid gap-2" style={{ gridTemplateColumns: `repeat(${columns}, minmax(0, 1fr))` }}>
            {options.map((option, idx) => (
              <label key={`${fieldKey}-${idx}`} className={`flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer transition-all ${selected.includes(option) ? 'bg-teal-50 border-teal-500 text-teal-700' : 'bg-white border-slate-200 hover:border-teal-300'}`}>
                <input type="checkbox" checked={selected.includes(option)} onChange={(e) => handleChange(option, e.target.checked)} className="w-4 h-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500" />
                <span className="text-sm">{option}</span>
              </label>
            ))}
          </div>
        </div>
      );
    });

    const RadioGroup = memo(({ options, selected, fieldKey, updateField, name, inline = false }) => {
      const handleChange = useCallback((option) => {
        updateField(fieldKey, option);
      }, [fieldKey, updateField]);

      return (
        <div className={inline ? "flex flex-wrap gap-2" : "flex flex-col gap-2"}>
          {options.map((option, idx) => (
            <label key={`${name}-${idx}`} className={`flex items-start gap-3 px-3 py-2 rounded-lg border cursor-pointer transition-all ${selected === option ? 'bg-teal-50 border-teal-500 text-teal-700' : 'bg-white border-slate-200 hover:border-teal-300'}`}>
              <input type="radio" name={name} checked={selected === option} onChange={() => handleChange(option)} className="mt-0.5 w-4 h-4 border-slate-300 text-teal-600 focus:ring-teal-500" />
              <span className="text-sm">{option}</span>
            </label>
          ))}
        </div>
      );
    });

    const ToggleOption = memo(({ label, checked, fieldKey, updateField, description }) => {
      const handleChange = useCallback((e) => {
        updateField(fieldKey, e.target.checked);
      }, [fieldKey, updateField]);

      return (
        <label className={`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition-all ${checked ? 'bg-green-50 border-green-500' : 'bg-white border-slate-200 hover:border-green-300'}`}>
          <input type="checkbox" checked={checked || false} onChange={handleChange} className="mt-0.5 w-5 h-5 rounded border-slate-300 text-green-600 focus:ring-green-500" />
          <div>
            <span className={`font-medium ${checked ? 'text-green-700' : 'text-slate-700'}`}>{label}</span>
            {description && <p className="text-xs text-slate-500 mt-1">{description}</p>}
          </div>
        </label>
      );
    });

    const SectionCard = ({ title, children, icon }) => (
      <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-4">
        <div className="bg-gradient-to-r from-slate-50 to-slate-100 px-4 py-3 border-b border-slate-200">
          <h3 className="font-semibold text-slate-700 flex items-center gap-2">
            {icon && <span>{icon}</span>}
            {title}
          </h3>
        </div>
        <div className="p-4 space-y-4">{children}</div>
      </div>
    );

    const SubSection = ({ title, children }) => (
      <div className="bg-slate-50 rounded-lg p-4 space-y-3">
        <h4 className="font-medium text-slate-600 text-sm uppercase tracking-wide">{title}</h4>
        {children}
      </div>
    );

    const CollapsibleSection = memo(({ title, icon, isOpen, onToggle, children, linkUrl }) => {
      const handleClick = () => {
        if (linkUrl) {
          window.open(linkUrl, '_blank');
        }
        onToggle();
      };

      return (
        <div className="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden mb-4">
          <button
            onClick={handleClick}
            className={`w-full px-4 py-4 flex items-center justify-between transition-all ${isOpen ? 'bg-gradient-to-r from-teal-50 to-cyan-50 border-b border-teal-200' : 'bg-gradient-to-r from-slate-50 to-slate-100 hover:from-slate-100 hover:to-slate-150'
              }`}
          >
            <div className="flex items-center gap-3">
              <input
                type="checkbox"
                checked={isOpen}
                onChange={() => { }}
                className="w-5 h-5 rounded border-slate-300 text-teal-600 focus:ring-teal-500"
              />
              <span className="text-xl">{icon}</span>
              <span className={`font-semibold ${isOpen ? 'text-teal-700' : 'text-slate-700'}`}>{title}</span>
              {linkUrl && <span className="text-xs text-blue-500 ml-2">üîó M·ªü link</span>}
            </div>
            {!linkUrl && (
              <span className={`transform transition-transform ${isOpen ? 'rotate-180' : ''}`}>‚ñº</span>
            )}
          </button>
          {isOpen && !linkUrl && (
            <div className="p-4 space-y-4">{children}</div>
          )}
        </div>
      );
    });

    const CollapsibleSubSection = memo(({ title, isOpen, onToggle, children }) => {
      return (
        <div className="bg-slate-50 rounded-lg overflow-hidden">
          <button
            onClick={onToggle}
            className={`w-full px-4 py-3 flex items-center justify-between transition-all ${isOpen ? 'bg-teal-50 border-b border-teal-200' : 'hover:bg-slate-100'}`}
          >
            <div className="flex items-center gap-3">
              <input
                type="checkbox"
                checked={isOpen}
                onChange={() => { }}
                className="w-4 h-4 rounded border-slate-300 text-teal-600 focus:ring-teal-500"
              />
              <h4 className={`font-medium text-sm uppercase tracking-wide ${isOpen ? 'text-teal-700' : 'text-slate-600'}`}>{title}</h4>
            </div>
            <span className={`transform transition-transform text-sm ${isOpen ? 'rotate-180' : ''}`}>‚ñº</span>
          </button>
          {isOpen && (
            <div className="p-4 space-y-3">{children}</div>
          )}
        </div>
      );
    });

    const GroupedRadioItem = memo(({ label, name, options, selected, fieldKey, updateField }) => {
      const handleChange = useCallback((option) => {
        updateField(fieldKey, option);
      }, [fieldKey, updateField]);

      return (
        <div className="p-3 bg-white rounded-lg border border-slate-200 space-y-2">
          <p className="text-sm text-slate-600 font-medium">{label}</p>
          <div className="flex flex-wrap gap-2">
            {options.map((option, idx) => (
              <label key={`${name}-opt-${idx}`} className={`flex items-center gap-2 px-3 py-1.5 rounded-lg border cursor-pointer transition-all text-sm ${selected === option ? 'bg-teal-100 border-teal-500 text-teal-700' : 'bg-slate-50 border-slate-200 hover:border-teal-300'}`}>
                <input type="radio" name={name} checked={selected === option} onChange={() => handleChange(option)} className="w-3 h-3 border-slate-300 text-teal-600 focus:ring-teal-500" />
                <span>{option}</span>
              </label>
            ))}
          </div>
        </div>
      );
    });

    const InlineRadioSelect = memo(({ label, name, options, selected, fieldKey, updateField }) => {
      const handleChange = useCallback((option) => {
        updateField(fieldKey, option);
      }, [fieldKey, updateField]);

      return (
        <div className="flex flex-wrap items-center gap-3">
          <span className="text-slate-700 font-medium">{label}</span>
          <div className="flex gap-2">
            {options.map((opt, idx) => (
              <label key={`${name}-${idx}`} className={`px-3 py-1.5 rounded-lg border cursor-pointer text-sm transition-all ${selected === opt ? 'bg-teal-100 border-teal-500 text-teal-700' : 'bg-slate-50 border-slate-200 hover:border-teal-300'}`}>
                <input type="radio" name={name} checked={selected === opt} onChange={() => handleChange(opt)} className="sr-only" />
                {opt}
              </label>
            ))}
          </div>
        </div>
      );
    });

    const MucDoSelect = memo(({ label, value, fieldKey, updateField, options }) => {
      const handleChange = useCallback((e) => {
        updateField(fieldKey, e.target.value);
      }, [fieldKey, updateField]);

      const optionList = options || CONFIG.mucDoTriTueOptions;

      return (
        <div className="flex flex-wrap items-center gap-2">
          {label && <span className="text-slate-600">{label}</span>}
          <select
            value={value || ''}
            onChange={handleChange}
            className="px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 bg-white text-sm"
          >
            <option value="">-- Ch·ªçn m·ª©c ƒë·ªô --</option>
            {optionList.map(opt => (
              <option key={opt} value={opt}>{opt}</option>
            ))}
          </select>
        </div>
      );
    });

    /*
    ============================================================================
    TAB COMPONENTS
    ============================================================================
    */

    const TienCanTab = memo(({ formData, updateField }) => (
      <div className="space-y-4">
        <SectionCard title="1. Qu√° tr√¨nh ph√°t tri·ªÉn" icon="üë∂">
          <div className="space-y-4">
            <div className="flex flex-wrap items-center gap-3 p-3 bg-blue-50 rounded-lg">
              <span className="text-slate-700 font-medium">Con</span>
              <InputField fieldKey="thuTu1" value={formData.thuTu1} updateField={updateField} placeholder="th·ª©" />
              <span>/</span>
              <InputField fieldKey="thuTu2" value={formData.thuTu2} updateField={updateField} placeholder="t·ªïng" />
            </div>

            <SubSection title="C√°ch sinh">
              <CheckboxGroup options={CONFIG.cachSinhOptions} selected={formData.cachSinh || []} fieldKey="cachSinh" updateField={updateField} columns={3} />
            </SubSection>

            <SubSection title="Tu·ªïi thai">
              <div className="flex flex-wrap items-center gap-3">
                <RadioGroup name="tuoiThai" options={['ƒë·ªß th√°ng', 'non th√°ng']} selected={formData.tuoiThai} fieldKey="tuoiThai" updateField={updateField} inline={true} />
                {formData.tuoiThai === 'non th√°ng' && (
                  <InputField fieldKey="soTuanThai" label="Thai" value={formData.soTuanThai} updateField={updateField} placeholder="s·ªë" suffix="tu·∫ßn" />
                )}
              </div>
            </SubSection>

            <InputField fieldKey="cnls" label="CNLS:" value={formData.cnls} updateField={updateField} placeholder="c√¢n n·∫∑ng" suffix="kg" />

            <ToggleOption label="Kh√¥ng ghi nh·∫≠n b·∫•t th∆∞·ªùng sau sinh" checked={formData.batThuongSauSinh} fieldKey="batThuongSauSinh" updateField={updateField} />

            <div className="flex flex-wrap items-center gap-4 p-3 bg-purple-50 rounded-lg">
              <InputField fieldKey="bietDi" label="Bi·∫øt ƒëi l√∫c" value={formData.bietDi} updateField={updateField} placeholder="s·ªë" suffix="th√°ng," />
              <div className="flex items-center gap-2">
                <select value={formData.bietNoi || ''} onChange={(e) => updateField('bietNoi', e.target.value)} className="px-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 bg-white">
                  <option value="">-- Ch·ªçn --</option>
                  <option value="ƒë√£ bi·∫øt n√≥i">bi·∫øt n√≥i t·ª´ ƒë∆°n l√∫c</option>
                  <option value="ch∆∞a bi·∫øt n√≥i">ch∆∞a bi·∫øt n√≥i</option>
                </select>
                {formData.bietNoi === 'ƒë√£ bi·∫øt n√≥i' && (
                  <InputField fieldKey="thangNoi" value={formData.thangNoi} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                )}
              </div>
            </div>

            <InputField fieldKey="benhManTinh" label="B·ªánh m√£n t√≠nh ƒëang ƒëi·ªÅu tr·ªã:" value={formData.benhManTinh} updateField={updateField} placeholder="t√™n b·ªánh ho·∫∑c kh√¥ng" className="w-full" />
          </div>
        </SectionCard>

        <SectionCard title="2. B·ªánh s·ª≠" icon="üìã">
          <div className="space-y-4">
            <div className="flex gap-4">
              <label className={`flex-1 flex items-center justify-center gap-2 p-4 rounded-lg border-2 cursor-pointer transition-all ${formData.tinhTrangKham === 'chuaKham' ? 'bg-blue-50 border-blue-500 text-blue-700' : 'bg-white border-slate-200 hover:border-blue-300'}`}>
                <input type="radio" name="tinhTrangKham" checked={formData.tinhTrangKham === 'chuaKham'} onChange={() => updateField('tinhTrangKham', 'chuaKham')} className="w-4 h-4" />
                <span className="font-medium">Ch∆∞a kh√°m l·∫ßn n√†o</span>
              </label>
              <label className={`flex-1 flex items-center justify-center gap-2 p-4 rounded-lg border-2 cursor-pointer transition-all ${formData.tinhTrangKham === 'daKham' ? 'bg-amber-50 border-amber-500 text-amber-700' : 'bg-white border-slate-200 hover:border-amber-300'}`}>
                <input type="radio" name="tinhTrangKham" checked={formData.tinhTrangKham === 'daKham'} onChange={() => updateField('tinhTrangKham', 'daKham')} className="w-4 h-4" />
                <span className="font-medium">ƒê√£ kh√°m</span>
              </label>
            </div>

            {formData.tinhTrangKham === 'daKham' && (
              <div className="space-y-4 p-4 bg-amber-50 rounded-lg border border-amber-200">
                <InputField fieldKey="tuoiKham" label="L√∫c" value={formData.tuoiKham} updateField={updateField} placeholder="s·ªë" suffix="th√°ng, kh√°m t·∫°i" />
                <SubSection title="N∆°i kh√°m">
                  <CheckboxGroup options={CONFIG.noiKhamOptions} selected={formData.noiKham || []} fieldKey="noiKham" updateField={updateField} columns={3} />
                </SubSection>
                <SubSection title="L√Ω do kh√°m">
                  <CheckboxGroup options={CONFIG.lyDoKhamOptions} selected={formData.lyDoKham || []} fieldKey="lyDoKham" updateField={updateField} columns={2} />
                </SubSection>
                <SubSection title="Ch·∫©n ƒëo√°n tr∆∞·ªõc ƒë√¢y">
                  <CheckboxGroup options={CONFIG.chanDoanTruocOptions} selected={formData.chanDoanTruoc || []} fieldKey="chanDoanTruoc" updateField={updateField} columns={2} />
                </SubSection>
                <ToggleOption label="Sau kh√°m c√≥ can thi·ªáp" checked={formData.sauKham} fieldKey="sauKham" updateField={updateField} />
                {formData.sauKham && (
                  <div className="flex flex-wrap items-center gap-3 p-3 bg-white rounded-lg">
                    <span className="text-slate-600">T·∫ßn su·∫•t:</span>
                    <InputField fieldKey="gioCanThiep" value={formData.gioCanThiep} updateField={updateField} placeholder="s·ªë" suffix="gi·ªù/ng√†y x" />
                    <InputField fieldKey="ngayCanThiep" value={formData.ngayCanThiep} updateField={updateField} placeholder="s·ªë" suffix="ng√†y/tu·∫ßn," />
                    <InputField fieldKey="tongThoiGianCanThiep" label="t·ªïng th·ªùi gian" value={formData.tongThoiGianCanThiep} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                  </div>
                )}
              </div>
            )}
          </div>
        </SectionCard>

        <SectionCard title="3. M√¥i tr∆∞·ªùng s·ªëng" icon="üè†">
          <SubSection title="B√© ƒëang s·ªëng v·ªõi">
            <CheckboxGroup options={CONFIG.songVoiOptions} selected={formData.songVoi || []} fieldKey="songVoi" updateField={updateField} columns={3} />
          </SubSection>
          <SubSection title="Th·ªùi gian ti·∫øp x√∫c m√†n h√¨nh">
            <div className="flex flex-wrap items-center gap-3">
              <InputField fieldKey="screenTruocDay" label="Tr∆∞·ªõc ƒë√¢y kho·∫£ng" value={formData.screenTruocDay} updateField={updateField} placeholder="s·ªë" suffix="gi·ªù m·ªói ng√†y." />
              <InputField fieldKey="screenDaNgung" label="ƒê√£ ng·ª´ng" value={formData.screenDaNgung} updateField={updateField} placeholder="s·ªë" suffix="th√°ng nay." />
              <InputField fieldKey="screenHienTai" label="Hi·ªán t·∫°i:" value={formData.screenHienTai} updateField={updateField} placeholder="s·ªë" suffix="gi·ªù m·ªói ng√†y." />
            </div>
          </SubSection>
        </SectionCard>

        <SectionCard title="4. C√°c lo l·∫Øng hi·ªán t·∫°i c·ªßa ph·ª• huynh" icon="üòü">
          <CheckboxGroup options={CONFIG.loLangOptions} selected={formData.loLang || []} fieldKey="loLang" updateField={updateField} columns={2} />
          <InputField fieldKey="loLangKhac" label="Kh√°c:" value={formData.loLangKhac} updateField={updateField} placeholder="nh·∫≠p lo l·∫Øng kh√°c" className="w-full mt-3" />
        </SectionCard>

        <SectionCard title="5. Ph·ªèng v·∫•n th√™m" icon="üí¨">
          <SubSection title="a. T∆∞∆°ng t√°c x√£ h·ªôi - c·∫£m x√∫c">
            <div className="space-y-3">
              <GroupedRadioItem label="ƒê√°p ·ª©ng t√™n g·ªçi:" name="pvDapUngTen" options={['Ho√†n to√†n kh√¥ng ƒë√°p ·ª©ng', 'Ch·ªâ ƒë√°p ·ª©ng trong t√¨nh hu·ªëng quen thu·ªôc', 'ƒê√°p ·ª©ng nh∆∞ng ch·∫≠m/c·∫ßn nh·∫Øc', 'ƒê√°p ·ª©ng b√¨nh th∆∞·ªùng']} selected={formData.pvDapUngTen} fieldKey="pvDapUngTen" updateField={updateField} />
              <GroupedRadioItem label="Kh·ªüi ƒë·∫ßu t∆∞∆°ng t√°c:" name="pvTuongTac" options={['Lu√¥n tr√°nh n√©', 'Hi·∫øm khi ch·ªß ƒë·ªông', 'C·∫ßn h·ªó tr·ª£', 'T·ª± nhi√™n']} selected={formData.pvTuongTac} fieldKey="pvTuongTac" updateField={updateField} />
              <GroupedRadioItem label="Khoe v√† g√¢y ch√∫ √Ω:" name="pvKhoe" options={['Kh√¥ng khoe/g√¢y ch√∫ √Ω', 'C√≥ nh∆∞ng √≠t', 'Th∆∞·ªùng xuy√™n']} selected={formData.pvKhoe} fieldKey="pvKhoe" updateField={updateField} />
              <GroupedRadioItem label="C∆∞·ªùi x√£ h·ªôi:" name="pvCuoiXaHoi" options={['Kh√¥ng c∆∞·ªùi x√£ h·ªôi', 'C√≥ nh∆∞ng kh√¥ng th∆∞·ªùng xuy√™n', 'B√¨nh th∆∞·ªùng']} selected={formData.pvCuoiXaHoi} fieldKey="pvCuoiXaHoi" updateField={updateField} />
            </div>
          </SubSection>
          <SubSection title="b. H√†nh vi giao ti·∫øp phi ng√¥n ng·ªØ">
            <div className="space-y-3">
              <GroupedRadioItem label="Giao ti·∫øp b·∫±ng m·∫Øt/c·ª≠ ch·ªâ:" name="pvGiaoTiepMat" options={['Ho√†n to√†n kh√¥ng', 'Ch·ªâ trong t√¨nh hu·ªëng quen', 'C√≥ nh∆∞ng ch·∫≠m/c·∫ßn nh·∫Øc', 'B√¨nh th∆∞·ªùng']} selected={formData.pvGiaoTiepMat} fieldKey="pvGiaoTiepMat" updateField={updateField} />
              <GroupedRadioItem label="Bi·ªÉu c·∫£m khu√¥n m·∫∑t:" name="pvBieuCam" options={['Kh√¥ng c√≥ bi·ªÉu c·∫£m', 'H·∫°n ch·∫ø/kh√¥ng ph√π h·ª£p', 'ƒê∆°n gi·∫£n nh∆∞ng thi·∫øu t·ª± nhi√™n', 'Ph·∫£n ·ª©ng ph√π h·ª£p']} selected={formData.pvBieuCam} fieldKey="pvBieuCam" updateField={updateField} />
              <GroupedRadioItem label="Nh·∫≠n ra bi·ªÉu c·∫£m ng∆∞·ªùi kh√°c:" name="pvNhanBieuCam" options={['Kh√¥ng nh·∫≠n ra', 'Kh√≥ nh·∫≠n ra/c·∫ßn h·ªó tr·ª£', 'S·ª≠ d·ª•ng c·ª≠ ch·ªâ ph√π h·ª£p']} selected={formData.pvNhanBieuCam} fieldKey="pvNhanBieuCam" updateField={updateField} />
            </div>
          </SubSection>
          <SubSection title="c. Ph√°t tri·ªÉn, duy tr√¨ v√† hi·ªÉu m·ªëi quan h·ªá">
            <div className="space-y-3">
              <GroupedRadioItem label="Quan t√¢m ch∆°i v·ªõi ng∆∞·ªùi kh√°c:" name="pvChoiVoiNguoiKhac" options={['Ho√†n to√†n kh√¥ng', 'Ch·ªâ trong t√¨nh hu·ªëng quen', 'C√≥ th·ªÉ nh∆∞ng ch·∫≠m/c·∫ßn nh·∫Øc', 'B√¨nh th∆∞·ªùng']} selected={formData.pvChoiVoiNguoiKhac} fieldKey="pvChoiVoiNguoiKhac" updateField={updateField} />
              <GroupedRadioItem label="Tham gia tr√≤ ch∆°i nh√≥m/gi·∫£ t∆∞·ªüng:" name="pvTroChoiNhom" options={['Kh√¥ng tham gia', 'Ch·ªâ khi ƒë∆∞·ª£c h∆∞·ªõng d·∫´n', 'Tham gia nh∆∞ng thi·∫øu t·ª± nhi√™n', 'T·ª± nhi√™n']} selected={formData.pvTroChoiNhom} fieldKey="pvTroChoiNhom" updateField={updateField} />
              <GroupedRadioItem label="ƒêi·ªÅu ch·ªânh h√†nh vi theo b·ªëi c·∫£nh:" name="pvChoiMotMinh" options={['Lu√¥n ch∆°i m·ªôt m√¨nh', 'Kh√≥ thay ƒë·ªïi theo b·ªëi c·∫£nh', 'C·∫ßn h·ªó tr·ª£ chia s·∫ª/l∆∞·ª£t ch∆°i', 'ƒêi·ªÅu ch·ªânh ph√π h·ª£p']} selected={formData.pvChoiMotMinh} fieldKey="pvChoiMotMinh" updateField={updateField} />
            </div>
          </SubSection>
          <SubSection title="d. H√†nh vi l·∫∑p l·∫°i">
            <CheckboxGroup options={CONFIG.hanhViLapLaiOptions} selected={formData.hanhViLapLai || []} fieldKey="hanhViLapLai" updateField={updateField} columns={3} />
          </SubSection>
          <SubSection title="e. B√°m v√≠u th√≥i quen">
            <CheckboxGroup options={CONFIG.bamViuThoiQuenOptions} selected={formData.bamViuThoiQuen || []} fieldKey="bamViuThoiQuen" updateField={updateField} columns={2} />
          </SubSection>
          <SubSection title="f. S·ªü th√≠ch h·∫°n ch·∫ø">
            <CheckboxGroup options={CONFIG.soThichHanCheOptions} selected={formData.soThichHanChe || []} fieldKey="soThichHanChe" updateField={updateField} columns={2} />
            <InputField fieldKey="soThichKhac" label="Kh√°c:" value={formData.soThichKhac} updateField={updateField} placeholder="nh·∫≠p s·ªü th√≠ch kh√°c" className="w-full mt-3" />
          </SubSection>
          <SubSection title="g. Ph·∫£n ·ª©ng gi√°c quan">
            <CheckboxGroup options={CONFIG.phanUngGiacQuanOptions} selected={formData.phanUngGiacQuan || []} fieldKey="phanUngGiacQuan" updateField={updateField} columns={2} />
          </SubSection>
        </SectionCard>
      </div>
    ));

    const KhamTab = memo(({ formData, updateField, caputeScores }) => {
      const toggleSection = useCallback((section) => {
        updateField(section, !formData[section]);
      }, [formData, updateField]);

      return (
        <div className="space-y-4">
          <SectionCard title="1. Tr·∫ª ch∆°i t·ª± do" icon="üß∏">
            <ToggleOption label="N√©p v√†o/n√∫p sau l∆∞ng ng∆∞·ªùi chƒÉm s√≥c, v·∫ª nh√∫t nh√°t" checked={formData.nepVao} fieldKey="nepVao" updateField={updateField} />
            <SubSection title="ƒê√°nh gi√° khi t·ª± ch∆°i">
              <RadioGroup name="danhGiaKhiTuChoi" options={CONFIG.danhGiaKhiTuChoiOptions} selected={formData.danhGiaKhiTuChoi} fieldKey="danhGiaKhiTuChoi" updateField={updateField} />
            </SubSection>
            <SubSection title="H√†nh vi">
              <CheckboxGroup options={CONFIG.hanhViKhamOptions} selected={formData.hanhViKham || []} fieldKey="hanhViKham" updateField={updateField} columns={1} />
            </SubSection>
            <SubSection title="Ch∆°i ƒë·ªì ch∆°i kh√¥ng ƒë√∫ng ch·ª©c nƒÉng">
              <CheckboxGroup options={CONFIG.choiDoChoiKhamOptions} selected={formData.choiDoChoiKham || []} fieldKey="choiDoChoiKham" updateField={updateField} columns={2} />
            </SubSection>
            <SubSection title="T∆∞∆°ng t√°c">
              <RadioGroup name="chuDongTuongTacKham" options={['Ch·ªß ƒë·ªông t∆∞∆°ng t√°c v·ªõi ng∆∞·ªùi kh√°m ƒë·ªÉ y√™u c·∫ßu ƒë·ªì ch∆°i kh√°c', 'T·ª± √Ω ƒë·∫øn l·∫•y ƒë·ªì ch∆°i, kh√¥ng quan t√¢m ƒë·∫øn ng∆∞·ªùi kh√°m']} selected={formData.chuDongTuongTacKham} fieldKey="chuDongTuongTacKham" updateField={updateField} />
            </SubSection>
          </SectionCard>

          <SectionCard title="2. T∆∞∆°ng t√°c v·ªõi tr·∫ª" icon="ü§ù">
            <SubSection title="a. T∆∞∆°ng t√°c x√£ h·ªôi - c·∫£m x√∫c">
              <div className="space-y-3">
                <GroupedRadioItem label="ƒê√°p ·ª©ng t√™n g·ªçi:" name="khamDapUngTen" options={['Ho√†n to√†n kh√¥ng ƒë√°p ·ª©ng', 'Ch·ªâ ƒë√°p ·ª©ng sau 5 l·∫ßn g·ªçi', 'ƒê√°p ·ª©ng b√¨nh th∆∞·ªùng']} selected={formData.khamDapUngTen} fieldKey="khamDapUngTen" updateField={updateField} />
                <GroupedRadioItem label="Th·ªÉ hi·ªán c·∫£m x√∫c:" name="khamTheHienCamXuc" options={['Kh√¥ng th·ªÉ hi·ªán', 'H·∫°n ch·∫ø/kh√¥ng ph√π h·ª£p', 'ƒê∆°n gi·∫£n nh∆∞ng thi·∫øu t·ª± nhi√™n', 'Ph√π h·ª£p']} selected={formData.khamTheHienCamXuc} fieldKey="khamTheHienCamXuc" updateField={updateField} />
                <GroupedRadioItem label="T∆∞∆°ng t√°c v·ªõi ng∆∞·ªùi kh√°m:" name="khamTuongTacNguoiKham" options={['Ho√†n to√†n kh√¥ng/kh√¥ng c∆∞·ªùi x√£ h·ªôi', 'C√≥ nh∆∞ng √≠t', 'C·∫ßn h·ªó tr·ª£', 'Ch·ªß ƒë·ªông v√† t·ª± nhi√™n']} selected={formData.khamTuongTacNguoiKham} fieldKey="khamTuongTacNguoiKham" updateField={updateField} />
              </div>
            </SubSection>
            <SubSection title="b. H√†nh vi giao ti·∫øp phi ng√¥n ng·ªØ">
              <div className="space-y-4">
                <div className="p-3 bg-white rounded-lg border border-slate-200 space-y-3">
                  <InlineRadioSelect label="Ti·∫øp x√∫c m·∫Øt v·ªõi ng∆∞·ªùi kh√°m:" name="khamTiepXucMat" options={['y·∫øu', 'trung b√¨nh', 't·ªët']} selected={formData.khamTiepXucMat} fieldKey="khamTiepXucMat" updateField={updateField} />
                  <div className="flex flex-wrap gap-2">
                    <span className="text-slate-700 font-medium w-full mb-1">Ch·ªâ b·∫±ng ng√≥n tr·ªè:</span>
                    {['ch∆∞a bi·∫øt ch·ªâ b·∫±ng ng√≥n tr·ªè', 'c√≥ ch·ªâ trong m·ªôt v√†i t√¨nh hu·ªëng', 'ch·ªâ t·ªët ƒë·ªÉ y√™u c·∫ßu v√† theo y√™u c·∫ßu'].map((opt, idx) => (
                      <label key={`chiNgonTro-${idx}`} className={`px-3 py-1.5 rounded-lg border cursor-pointer text-sm transition-all ${formData.khamChiNgonTro === opt ? 'bg-teal-100 border-teal-500 text-teal-700' : 'bg-slate-50 border-slate-200 hover:border-teal-300'}`}>
                        <input type="radio" name="khamChiNgonTro" checked={formData.khamChiNgonTro === opt} onChange={() => updateField('khamChiNgonTro', opt)} className="sr-only" />
                        {opt}
                      </label>
                    ))}
                  </div>
                  <InlineRadioSelect label="Kh·∫£ nƒÉng ch√∫ √Ω chung:" name="khamChuYChung" options={['y·∫øu', 'trung b√¨nh', 't·ªët']} selected={formData.khamChuYChung} fieldKey="khamChuYChung" updateField={updateField} />
                </div>
                <GroupedRadioItem label="Bi·ªÉu c·∫£m khu√¥n m·∫∑t:" name="khamBieuCam" options={['Kh√¥ng c√≥ bi·ªÉu c·∫£m', 'H·∫°n ch·∫ø/kh√¥ng ph√π h·ª£p', 'ƒê∆°n gi·∫£n nh∆∞ng thi·∫øu t·ª± nhi√™n', 'Ph·∫£n ·ª©ng ph√π h·ª£p']} selected={formData.khamBieuCam} fieldKey="khamBieuCam" updateField={updateField} />
              </div>
            </SubSection>
            <SubSection title="c. Ph√°t tri·ªÉn, duy tr√¨ v√† hi·ªÉu m·ªëi quan h·ªá">
              <div className="space-y-3">
                <GroupedRadioItem label="H·ª£p t√°c trong tr√≤ ch∆°i:" name="khamHopTac" options={['Ho√†n to√†n kh√¥ng h·ª£p t√°c', 'Ch·ªâ h·ª£p t√°c trong m·ªôt v√†i tr√≤ ch∆°i', 'H·ª£p t√°c t·ªët trong h·∫ßu h·∫øt']} selected={formData.khamHopTac} fieldKey="khamHopTac" updateField={updateField} />
                <GroupedRadioItem label="Ch∆°i gi·∫£ b·ªô:" name="khamChoiGiaBo" options={['Kh√¥ng tham gia', 'Bi·∫øt nh∆∞ng thi·∫øu t·ª± nhi√™n', 'T·ª± nhi√™n']} selected={formData.khamChoiGiaBo} fieldKey="khamChoiGiaBo" updateField={updateField} />
                <GroupedRadioItem label="Ch∆°i c√πng ng∆∞·ªùi kh√°m:" name="khamSayMeChoi" options={['Say m√™ ch∆°i m·ªôt m√¨nh', 'Ch·ªâ ch∆°i c√πng l√∫c ƒë·∫ßu', 'Ch∆°i c√πng ph·∫ßn l·ªõn th·ªùi gian']} selected={formData.khamSayMeChoi} fieldKey="khamSayMeChoi" updateField={updateField} />
              </div>
            </SubSection>
            <SubSection title="d. H√†nh vi b·∫•t th∆∞·ªùng">
              <CheckboxGroup options={CONFIG.khamHanhViBatThuongOptions} selected={formData.khamHanhViBatThuong || []} fieldKey="khamHanhViBatThuong" updateField={updateField} columns={3} />
              <div className="mt-3">
                <ToggleOption label="Ng∆∞·ªùi kh√°m kh√¥ng quan s√°t th·∫•y tr·∫ª c√≥ h√†nh vi b·∫•t th∆∞·ªùng trong qu√° tr√¨nh ƒë√°nh gi√°" checked={formData.khamKhongBatThuong} fieldKey="khamKhongBatThuong" updateField={updateField} />
              </div>
            </SubSection>
            
            <CollapsibleSubSection title="e. ƒê√°nh gi√° v·ªÅ m·ª©c ƒë·ªô t·∫≠p trung" isOpen={formData.openDanhGiaTapTrung} onToggle={() => toggleSection('openDanhGiaTapTrung')}>
              <div className="space-y-3">
                <GroupedRadioItem label="Tr·∫ª tr·∫£ l·ªùi ƒë∆∞·ª£c c√°c m√≥n ƒë√£ ƒÉn v√†o t·ªëi h√¥m tr∆∞·ªõc:" name="danhGiaMonAn" options={['th·ª±c hi·ªán ƒë∆∞·ª£c', 'kh√¥ng th·ª±c hi·ªán ƒë∆∞·ª£c']} selected={formData.danhGiaMonAn} fieldKey="danhGiaMonAn" updateField={updateField} />
                <GroupedRadioItem label="Gesell 3 b∆∞·ªõc:" name="danhGiaGesell" options={['th·ª±c hi·ªán ƒë∆∞·ª£c', 'kh√¥ng th·ª±c hi·ªán ƒë∆∞·ª£c']} selected={formData.danhGiaGesell} fieldKey="danhGiaGesell" updateField={updateField} />
                <GroupedRadioItem label="Nh·ªõ 3 v·∫≠t sau 5 ph√∫t:" name="danhGiaNho3Vat" options={['th·ª±c hi·ªán ƒë∆∞·ª£c', 'kh√¥ng th·ª±c hi·ªán ƒë∆∞·ª£c']} selected={formData.danhGiaNho3Vat} fieldKey="danhGiaNho3Vat" updateField={updateField} />
                <GroupedRadioItem label="Th·ª±c hi·ªán ph√©p tr·ª´ 100-7-7-7-7:" name="danhGiaPhepTru" options={['th·ª±c hi·ªán ƒë∆∞·ª£c', 'kh√¥ng th·ª±c hi·ªán ƒë∆∞·ª£c']} selected={formData.danhGiaPhepTru} fieldKey="danhGiaPhepTru" updateField={updateField} />
                <div className="p-3 bg-white rounded-lg border border-slate-200 space-y-3">
                  <InputField fieldKey="lapLaiSo" label="L·∫∑p l·∫°i ƒë∆∞·ª£c" value={formData.lapLaiSo} updateField={updateField} placeholder="s·ªë" suffix="s·ªë" />
                  <InputField fieldKey="daoSo" label="ƒê·∫£o ƒë∆∞·ª£c" value={formData.daoSo} updateField={updateField} placeholder="s·ªë" suffix="s·ªë" />
                </div>
              </div>
            </CollapsibleSubSection>
            
            <CollapsibleSubSection title="f. Ng∆∞·ªùi kh√°m ƒë√°nh gi√° c√°c m·ªëc ph√°t tri·ªÉn c·ªßa tr·∫ª" isOpen={formData.openDanhGiaMocPhatTrien} onToggle={() => toggleSection('openDanhGiaMocPhatTrien')}>
              <div className="space-y-4">
                <div className="p-3 bg-blue-50 rounded-lg border border-blue-200">
                  <InputField fieldKey="tuoiThang" label="üéÇ Tu·ªïi c·ªßa tr·∫ª (ƒë·ªÉ t√≠nh Capute):" value={formData.tuoiThang} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                </div>
                <div className="p-3 bg-purple-50 rounded-lg">
                  <h5 className="font-medium text-slate-700 mb-3">* ƒê√°nh gi√° nhanh c√°c lƒ©nh v·ª±c ph√°t tri·ªÉn:</h5>
                  <div className="grid grid-cols-2 gap-3">
                    <InputField fieldKey="vanDongTho" label="V·∫≠n ƒë·ªông th√¥:" value={formData.vanDongTho} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                    <InputField fieldKey="ngonNguHieu" label="Ng√¥n ng·ªØ hi·ªÉu:" value={formData.ngonNguHieu} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                    <InputField fieldKey="ngonNguDienDat" label="Ng√¥n ng·ªØ di·ªÖn ƒë·∫°t:" value={formData.ngonNguDienDat} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                    <InputField fieldKey="giaiQuyetVanDe" label="Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ:" value={formData.giaiQuyetVanDe} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                    <InputField fieldKey="xaHoi" label="X√£ h·ªôi:" value={formData.xaHoi} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                  </div>
                </div>
                <div className="flex flex-wrap items-center gap-3 p-3 bg-orange-50 rounded-lg">
                  <span className="font-medium text-slate-700">* Tho√°i l√πi k·ªπ nƒÉng:</span>
                  <InputField fieldKey="thoaiLuiKyNang" value={formData.thoaiLuiKyNang} updateField={updateField} placeholder="k·ªπ nƒÉng" />
                  <span>l√∫c</span>
                  <InputField fieldKey="thoaiLuiLuc" value={formData.thoaiLuiLuc} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                </div>
                <div className="p-4 bg-gradient-to-br from-teal-50 to-cyan-50 rounded-lg border border-teal-200">
                  <h5 className="font-medium text-teal-800 mb-4">* ƒê√°nh gi√° theo thang Capute:</h5>
                  <div className="grid grid-cols-2 gap-4 mb-4">
                    <InputField fieldKey="tuoiTranR" label="Tu·ªïi tr·∫ßn ng√¥n ng·ªØ c·∫£m nh·∫≠n (R):" value={formData.tuoiTranR} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                    <InputField fieldKey="tuoiTranE" label="Tu·ªïi tr·∫ßn ng√¥n ng·ªØ di·ªÖn ƒë·∫°t (E):" value={formData.tuoiTranE} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                    <InputField fieldKey="clams" label="ƒêi·ªÉm ng√¥n ng·ªØ (CLAMS):" value={formData.clams} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                    <InputField fieldKey="cat" label="ƒêi·ªÉm nh·∫≠n th·ª©c (CAT):" value={formData.cat} updateField={updateField} placeholder="s·ªë" suffix="th√°ng" />
                  </div>
                  <div className="mt-4 p-3 bg-white rounded-lg border border-teal-300">
                    <h6 className="font-medium text-teal-700 mb-2">üìä K·∫øt qu·∫£ t√≠nh to√°n t·ª± ƒë·ªông:</h6>
                    <div className="space-y-2 text-sm">
                      <div className="flex justify-between items-center p-2 bg-teal-50 rounded">
                        <span>CLAMS DQ</span>
                        <span className="font-bold text-teal-700">{formData.tuoiThang && formData.clams ? `${formData.clams}/${formData.tuoiThang} x 100 = ${caputeScores.clamsDQ}%` : '-- %'}</span>
                      </div>
                      <div className="flex justify-between items-center p-2 bg-cyan-50 rounded">
                        <span>CAT DQ</span>
                        <span className="font-bold text-cyan-700">{formData.tuoiThang && formData.cat ? `${formData.cat}/${formData.tuoiThang} x 100 = ${caputeScores.catDQ}%` : '-- %'}</span>
                      </div>
                      <div className="flex justify-between items-center p-2 bg-emerald-50 rounded">
                        <span>Full Scale DQ</span>
                        <span className="font-bold text-emerald-700">{formData.tuoiThang && formData.clams && formData.cat ? `(${caputeScores.clamsDQ} + ${caputeScores.catDQ})/2 = ${caputeScores.fullScaleDQ}%` : '-- %'}</span>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </CollapsibleSubSection>
          </SectionCard>
        </div>
      );
    });

    const ChiDinhTab = memo(({ formData, updateField }) => {
      const toggleSection = useCallback((section) => {
        updateField(section, !formData[section]);
      }, [formData, updateField]);

      return (
        <div className="space-y-4">
          <p className="text-slate-600 text-sm italic mb-4">üìå Tick ch·ªçn v√†o c√°c m·ª•c c·∫ßn s·ª≠ d·ª•ng ƒë·ªÉ m·ªü n·ªôi dung chi ti·∫øt</p>

          <CollapsibleSection title="1. Vineland II" icon="üìä" isOpen={formData.openVineland} onToggle={() => toggleSection('openVineland')} linkUrl="https://gemini.google.com/gem/13Q9UC8nDG4mSWQlJlVC847wb7eTFtDK6?usp=sharing" />

          <CollapsibleSection title="2. Phi·∫øu ADHD ph·ª• huynh" icon="üë®‚Äçüë©‚Äçüë¶" isOpen={formData.openADHDPH} onToggle={() => toggleSection('openADHDPH')}>
            <div className="space-y-3">
              <InputField fieldKey="adhdPHKemTapTrung" label="Bi·ªÉu hi·ªán k√©m t·∫≠p trung =" value={formData.adhdPHKemTapTrung} updateField={updateField} placeholder="s·ªë" suffix="/9" />
              <InputField fieldKey="adhdPHTangDong" label="Bi·ªÉu hi·ªán tƒÉng ƒë·ªông =" value={formData.adhdPHTangDong} updateField={updateField} placeholder="s·ªë" suffix="/9" />
              <InputField fieldKey="adhdPHAnhHuong" label="·∫¢nh h∆∞·ªüng ch·ª©c nƒÉng:" value={formData.adhdPHAnhHuong} updateField={updateField} placeholder="m√¥ t·∫£" className="w-full" />
            </div>
          </CollapsibleSection>

          <CollapsibleSection title="3. Phi·∫øu ADHD gi√°o vi√™n" icon="üë©‚Äçüè´" isOpen={formData.openADHDGV} onToggle={() => toggleSection('openADHDGV')}>
            <div className="space-y-3">
              <InputField fieldKey="adhdGVKemTapTrung" label="Bi·ªÉu hi·ªán k√©m t·∫≠p trung =" value={formData.adhdGVKemTapTrung} updateField={updateField} placeholder="s·ªë" suffix="/9" />
              <InputField fieldKey="adhdGVTangDong" label="Bi·ªÉu hi·ªán tƒÉng ƒë·ªông =" value={formData.adhdGVTangDong} updateField={updateField} placeholder="s·ªë" suffix="/9" />
              <InputField fieldKey="adhdGVAnhHuong" label="·∫¢nh h∆∞·ªüng ch·ª©c nƒÉng:" value={formData.adhdGVAnhHuong} updateField={updateField} placeholder="m√¥ t·∫£" className="w-full" />
            </div>
          </CollapsibleSection>

          <CollapsibleSection title="4. Test NEMI 2" icon="üß†" isOpen={formData.openNEMI} onToggle={() => toggleSection('openNEMI')}>
            <div className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <InputField fieldKey="nemiNgayLam" label="Ng√†y l√†m tr·∫Øc nghi·ªám:" value={formData.nemiNgayLam} updateField={updateField} placeholder="dd/mm/yyyy" />
                <InputField fieldKey="nemiNguoiLam" label="Ng∆∞·ªùi l√†m tr·∫Øc nghi·ªám: CVTL." value={formData.nemiNguoiLam} updateField={updateField} placeholder="H·ªç t√™n" />
              </div>
              <InputField fieldKey="nemiThaiDo" label="Th√°i ƒë·ªô khi l√†m tr·∫Øc nghi·ªám:" value={formData.nemiThaiDo} updateField={updateField} placeholder="M√¥ t·∫£ th√°i ƒë·ªô" className="w-full" />
              <div className="p-4 bg-blue-50 rounded-lg space-y-4">
                <h5 className="font-medium text-blue-800">K·∫øt qu·∫£ tr·∫Øc nghi·ªám:</h5>
                <div className="space-y-3">
                  <div className="p-3 bg-white rounded-lg border"><p className="text-sm mb-2"><strong>a. Hi·ªÉu bi·∫øt t·ªïng qu√°t</strong> ·ªü m·ª©c ƒë·ªô:</p><div className="flex flex-wrap items-center gap-2"><MucDoSelect value={formData.nemiHieuBiet} fieldKey="nemiHieuBiet" updateField={updateField} /><span className="text-slate-600">so v·ªõi y√™u c·∫ßu c·ªßa l·ª©a tu·ªïi, tu·ªïi t∆∞∆°ng ƒë∆∞∆°ng:</span><InputField fieldKey="nemiHieuBietTuoi" value={formData.nemiHieuBietTuoi} updateField={updateField} placeholder="s·ªë" suffix="tu·ªïi" /></div></div>
                  <div className="p-3 bg-white rounded-lg border"><p className="text-sm mb-2"><strong>b. Kh·∫£ nƒÉng ph√¢n t√≠ch, kh√°i qu√°t v·∫•n ƒë·ªÅ</strong> ·ªü m·ª©c ƒë·ªô:</p><div className="flex flex-wrap items-center gap-2"><MucDoSelect value={formData.nemiPhanTich} fieldKey="nemiPhanTich" updateField={updateField} /><span className="text-slate-600">so v·ªõi y√™u c·∫ßu c·ªßa l·ª©a tu·ªïi, tu·ªïi t∆∞∆°ng ƒë∆∞∆°ng:</span><InputField fieldKey="nemiPhanTichTuoi" value={formData.nemiPhanTichTuoi} updateField={updateField} placeholder="s·ªë" suffix="tu·ªïi" /></div></div>
                  <div className="p-3 bg-white rounded-lg border"><p className="text-sm mb-2"><strong>c. T∆∞ duy logic</strong> ·ªü m·ª©c ƒë·ªô:</p><div className="flex flex-wrap items-center gap-2"><MucDoSelect value={formData.nemiTuDuy} fieldKey="nemiTuDuy" updateField={updateField} /><span className="text-slate-600">so v·ªõi y√™u c·∫ßu c·ªßa l·ª©a tu·ªïi, tu·ªïi t∆∞∆°ng ƒë∆∞∆°ng:</span><InputField fieldKey="nemiTuDuyTuoi" value={formData.nemiTuDuyTuoi} updateField={updateField} placeholder="s·ªë" suffix="tu·ªïi" /></div></div>
                  <div className="p-3 bg-white rounded-lg border"><p className="text-sm mb-2"><strong>d. Ng√¥n ng·ªØ</strong> ·ªü m·ª©c ƒë·ªô:</p><div className="flex flex-wrap items-center gap-2"><MucDoSelect value={formData.nemiNgonNgu} fieldKey="nemiNgonNgu" updateField={updateField} /><span className="text-slate-600">so v·ªõi y√™u c·∫ßu c·ªßa l·ª©a tu·ªïi, tu·ªïi t∆∞∆°ng ƒë∆∞∆°ng:</span><InputField fieldKey="nemiNgonNguTuoi" value={formData.nemiNgonNguTuoi} updateField={updateField} placeholder="s·ªë" suffix="tu·ªïi" /></div></div>
                </div>
              </div>
              <div className="p-4 bg-green-50 rounded-lg space-y-3">
                <h5 className="font-medium text-green-800">K·∫øt lu·∫≠n:</h5>
                <div className="flex flex-wrap items-center gap-2"><span className="text-slate-700">Ch·ªâ s·ªë th√¥ng minh hi·ªán nay: IQ =</span><InputField fieldKey="nemiIQ" value={formData.nemiIQ} updateField={updateField} placeholder="s·ªë" /></div>
                <p className="text-sm text-slate-600 italic">(Ch·ªâ s·ªë th√¥ng minh trung b√¨nh l√† 85-115)</p>
                <div className="flex flex-wrap items-center gap-2"><span className="text-slate-700">NƒÉng l·ª±c tr√≠ tu·ªá ·ªü m·ª©c</span><MucDoSelect value={formData.nemiKetLuan} fieldKey="nemiKetLuan" updateField={updateField} /><span className="text-slate-700">so v·ªõi tu·ªïi.</span></div>
              </div>
            </div>
          </CollapsibleSection>

          <CollapsibleSection title="5. Test WISC IV" icon="üß©" isOpen={formData.openWISC} onToggle={() => toggleSection('openWISC')}>
            <div className="space-y-4">
              <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                <InputField fieldKey="wiscNgayLam" label="Ng√†y l√†m tr·∫Øc nghi·ªám:" value={formData.wiscNgayLam} updateField={updateField} placeholder="dd/mm/yyyy" />
                <InputField fieldKey="wiscNguoiLam" label="Ng∆∞·ªùi l√†m tr·∫Øc nghi·ªám: CVTL." value={formData.wiscNguoiLam} updateField={updateField} placeholder="H·ªç t√™n" />
              </div>
              <InputField fieldKey="wiscThaiDo" label="Th√°i ƒë·ªô khi l√†m tr·∫Øc nghi·ªám:" value={formData.wiscThaiDo} updateField={updateField} placeholder="M√¥ t·∫£ th√°i ƒë·ªô" className="w-full" />
              <div className="p-4 bg-purple-50 rounded-lg space-y-4">
                <h5 className="font-medium text-purple-800">K·∫øt qu·∫£ tr·∫Øc nghi·ªám:</h5>
                <div className="space-y-3">
                  <div className="p-3 bg-white rounded-lg border"><p className="text-sm mb-2"><strong>a. T∆∞ duy ng√¥n ng·ªØ:</strong> Lƒ©nh v·ª±c n√†y, tr·∫ª th·ªÉ hi·ªán ·ªü m·ª©c:</p><div className="flex flex-wrap items-center gap-2"><MucDoSelect value={formData.wiscNgonNgu} fieldKey="wiscNgonNgu" updateField={updateField} options={CONFIG.mucDoTriTueWISCOptions} /><span className="text-slate-600">Ch·ªâ s·ªë l√†</span><InputField fieldKey="wiscNgonNguCS" value={formData.wiscNgonNguCS} updateField={updateField} placeholder="s·ªë" /></div></div>
                  <div className="p-3 bg-white rounded-lg border"><p className="text-sm mb-2"><strong>b. T∆∞ duy tri gi√°c:</strong> Lƒ©nh v·ª±c n√†y, tr·∫ª th·ªÉ hi·ªán ·ªü m·ª©c:</p><div className="flex flex-wrap items-center gap-2"><MucDoSelect value={formData.wiscTriGiac} fieldKey="wiscTriGiac" updateField={updateField} options={CONFIG.mucDoTriTueWISCOptions} /><span className="text-slate-600">Ch·ªâ s·ªë l√†</span><InputField fieldKey="wiscTriGiacCS" value={formData.wiscTriGiacCS} updateField={updateField} placeholder="s·ªë" /></div></div>
                  <div className="p-3 bg-white rounded-lg border"><p className="text-sm mb-2"><strong>c. Tr√≠ nh·ªõ c√¥ng vi·ªác:</strong> Lƒ©nh v·ª±c n√†y, tr·∫ª th·ªÉ hi·ªán ·ªü m·ª©c:</p><div className="flex flex-wrap items-center gap-2"><MucDoSelect value={formData.wiscTriNho} fieldKey="wiscTriNho" updateField={updateField} options={CONFIG.mucDoTriTueWISCOptions} /><span className="text-slate-600">Ch·ªâ s·ªë l√†</span><InputField fieldKey="wiscTriNhoCS" value={formData.wiscTriNhoCS} updateField={updateField} placeholder="s·ªë" /></div></div>
                  <div className="p-3 bg-white rounded-lg border"><p className="text-sm mb-2"><strong>d. T·ªëc ƒë·ªô x·ª≠ l√Ω:</strong> Lƒ©nh v·ª±c n√†y, tr·∫ª th·ªÉ hi·ªán ·ªü m·ª©c:</p><div className="flex flex-wrap items-center gap-2"><MucDoSelect value={formData.wiscTocDo} fieldKey="wiscTocDo" updateField={updateField} options={CONFIG.mucDoTriTueWISCOptions} /><span className="text-slate-600">Ch·ªâ s·ªë l√†</span><InputField fieldKey="wiscTocDoCS" value={formData.wiscTocDoCS} updateField={updateField} placeholder="s·ªë" /></div></div>
                </div>
              </div>
              <div className="p-4 bg-amber-50 rounded-lg space-y-3">
                <h5 className="font-medium text-amber-800">K·∫øt lu·∫≠n:</h5>
                <div className="flex flex-wrap items-center gap-2"><span className="text-slate-700">Ch·ªâ s·ªë th√¥ng minh: IQ =</span><InputField fieldKey="wiscIQ" value={formData.wiscIQ} updateField={updateField} placeholder="s·ªë" /></div>
                <p className="text-sm text-slate-600 italic">(Ch·ªâ s·ªë th√¥ng minh trung b√¨nh l√† 85-115)</p>
                <div className="flex flex-wrap items-center gap-2"><span className="text-slate-700">NƒÉng l·ª±c tr√≠ tu·ªá ·ªü m·ª©c</span><MucDoSelect value={formData.wiscKetLuan} fieldKey="wiscKetLuan" updateField={updateField} options={CONFIG.mucDoTriTueWISCOptions} /></div>
              </div>
            </div>
          </CollapsibleSection>
        </div>
      );
    });

    const KetQuaKhamTab = memo(({ formData, updateField }) => (
      <div className="space-y-4">
        <SectionCard title="CH·∫®N ƒêO√ÅN" icon="ü©∫">
          <CheckboxGroup options={CONFIG.chanDoanOptions} selected={formData.chanDoan || []} fieldKey="chanDoan" updateField={updateField} columns={2} />
          <InputField fieldKey="chanDoanKhac" label="Kh√°c:" value={formData.chanDoanKhac} updateField={updateField} placeholder="ch·∫©n ƒëo√°n kh√°c" className="w-full mt-3" />
        </SectionCard>
        <SectionCard title="ƒêI·ªÄU TR·ªä/CAN THI·ªÜP" icon="üíä">
          <div className="space-y-4">
            <ToggleOption label="Tr·∫ª c·∫ßn ƒë∆∞·ª£c h·ªçc can thi·ªáp v·ªõi ch∆∞∆°ng tr√¨nh c√° nh√¢n ph√π h·ª£p tu·ªïi ph√°t tri·ªÉn, 1 gi·ªù/ng√†y x 5 ng√†y + h·ªçc h√≤a nh·∫≠p" checked={formData.canThiepHocTap} fieldKey="canThiepHocTap" updateField={updateField} />
            <SubSection title="Ph·ª• huynh t∆∞∆°ng t√°c v·ªõi tr·∫ª theo h∆∞·ªõng d·∫´n">
              <CheckboxGroup options={CONFIG.huongDanPHOptions} selected={formData.huongDanPH || []} fieldKey="huongDanPH" updateField={updateField} columns={3} selectAllLabel="‚úì Ch·ªçn t·∫•t c·∫£" />
            </SubSection>
            <SubSection title="T√°i kh√°m">
              <RadioGroup name="taiKham" options={CONFIG.taiKhamOptions} selected={formData.taiKham} fieldKey="taiKham" updateField={updateField} inline={true} />
            </SubSection>
            <SubSection title="Kh√°m th√™m chuy√™n khoa">
              <CheckboxGroup options={CONFIG.khamThemChuyenKhoaOptions} selected={formData.khamThemChuyenKhoa || []} fieldKey="khamThemChuyenKhoa" updateField={updateField} columns={3} />
            </SubSection>
            <SubSection title="H∆∞·ªõng d·∫´n th√™m cho ph·ª• huynh">
              <div className="space-y-3">
                <ToggleOption label="V·ªá sinh gi·∫•c ng·ªß" description="2 ti·∫øng tr∆∞·ªõc khi ƒëi ng·ªß kh√¥ng ƒÉn qu√° no, kh√¥ng ƒë·ªÉ qu√° ƒë√≥i, kh√¥ng xem tivi ƒëi·ªán tho·∫°i, kh√¥ng v·∫≠n ƒë·ªông m·∫°nh." checked={formData.veSinhGiacNgu} fieldKey="veSinhGiacNgu" updateField={updateField} />
                <ToggleOption label="Ph·ªõt l·ªù c√°c h√†nh vi ƒÉn v·∫°" description="Kh√¥ng nh√¨n, kh√¥ng s·ªù, kh√¥ng n√≥i chuy·ªán, kh√¥ng ƒë√°p ·ª©ng y√™u c·∫ßu v√¥ l√Ω c·ªßa tr·∫ª. C·∫ßn c√≥ s·ª± ƒë·ªìng b·ªô gi·ªØa c√°c th√†nh vi√™n trong gia ƒë√¨nh ƒë·∫∑c bi·ªát l√† √¥ng b√†." checked={formData.photLoHanhVi} fieldKey="photLoHanhVi" updateField={updateField} />
                <ToggleOption label="Thi·∫øt l·∫≠p b·∫£ng th∆∞·ªüng; khen nhi·ªÅu h∆°n ch√™" checked={formData.bangThuong} fieldKey="bangThuong" updateField={updateField} />
                <ToggleOption label="Ch√∫ √Ω ƒëi·ªán tho·∫°i, nh·∫≠n b·ªánh √°n t√≥m t·∫Øt qua ƒë∆∞·ªùng b∆∞u ƒëi·ªán" description="Nh·∫≠n b·ªánh √°n t√≥m t·∫Øt sau 1 th√°ng qua ƒë∆∞·ªùng b∆∞u ƒëi·ªán. G·ªçi t·ªïng ƒë√†i n·∫øu sau 1 th√°ng ch∆∞a nh·∫≠n ƒë∆∞·ª£c." checked={formData.chuYDienThoai} fieldKey="chuYDienThoai" updateField={updateField} />
                <ToggleOption label="Mang theo cƒÉn c∆∞·ªõc c√¥ng d√¢n ƒë·∫øn qu·∫ßy th√¥ng tin" description="ƒê·∫øn qu·∫ßy th√¥ng tin ·ªü t·∫ßng tr·ªát ƒë·ªÉ ƒë∆∞·ª£c h∆∞·ªõng d·∫´n nh·∫≠n b·ªánh √°n t√≥m t·∫Øt sau 3 gi·ªù." checked={formData.mangTheoCCCD} fieldKey="mangTheoCCCD" updateField={updateField} />
              </div>
            </SubSection>
          </div>
        </SectionCard>
      </div>
    ));

    /*
    ============================================================================
    MAIN APP
    ============================================================================
    */
    function MedicalExamApp() {
      const [formData, setFormData] = useState({});
      const [activeMainTab, setActiveMainTab] = useState('tienCan');
      const [showOutput, setShowOutput] = useState(false);
      const [outputText, setOutputText] = useState('');

      const updateField = useCallback((key, value) => {
        setFormData(prev => ({ ...prev, [key]: value }));
      }, []);

      const resetForm = useCallback(() => {
        if (window.confirm('B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a t·∫•t c·∫£ d·ªØ li·ªáu ƒë√£ nh·∫≠p?')) {
          setFormData({});
          setOutputText('');
          setShowOutput(false);
        }
      }, []);

      const caputeScores = useMemo(() => {
        const tuoiThang = parseFloat(formData.tuoiThang) || 0;
        const clams = parseFloat(formData.clams) || 0;
        const cat = parseFloat(formData.cat) || 0;
        const clamsDQ = tuoiThang > 0 ? Math.round((clams / tuoiThang) * 100) : 0;
        const catDQ = tuoiThang > 0 ? Math.round((cat / tuoiThang) * 100) : 0;
        const fullScaleDQ = Math.round((clamsDQ + catDQ) / 2);
        return { clamsDQ, catDQ, fullScaleDQ };
      }, [formData.tuoiThang, formData.clams, formData.cat]);

      const generateOutput = useCallback(() => {
        let lines = [];
        let hasTienCan = false;
        let hasKham = false;
        let hasChiDinh = false;
        let hasChanDoan = false;
        let hasDieuTri = false;

        // ============ TI·ªÄN CƒÇN ============
        let tienCanLines = [];
        
        // 1. Qu√° tr√¨nh ph√°t tri·ªÉn
        let phatTrienLines = [];
        let birthParts = [];
        if (formData.thuTu1 || formData.thuTu2) birthParts.push(`Con ${formData.thuTu1 || '..'}/${formData.thuTu2 || '..'}`);
        if (formData.cachSinh?.length > 0) birthParts.push(formData.cachSinh.join(', '));
        if (formData.tuoiThai === 'ƒë·ªß th√°ng') birthParts.push('ƒë·ªß th√°ng');
        else if (formData.tuoiThai === 'non th√°ng' && formData.soTuanThai) birthParts.push(`thai ${formData.soTuanThai} tu·∫ßn`);
        if (formData.cnls) birthParts.push(`CNLS: ${formData.cnls} kg`);
        if (birthParts.length > 0) phatTrienLines.push('- ' + birthParts.join(', ') + '.');
        if (formData.batThuongSauSinh) phatTrienLines.push('- Kh√¥ng ghi nh·∫≠n b·∫•t th∆∞·ªùng sau sinh.');
        let devParts = [];
        if (formData.bietDi) devParts.push(`Bi·∫øt ƒëi l√∫c ${formData.bietDi} th√°ng`);
        if (formData.bietNoi === 'ƒë√£ bi·∫øt n√≥i' && formData.thangNoi) devParts.push(`bi·∫øt n√≥i t·ª´ ƒë∆°n l√∫c ${formData.thangNoi} th√°ng`);
        else if (formData.bietNoi === 'ch∆∞a bi·∫øt n√≥i') devParts.push('ch∆∞a bi·∫øt n√≥i');
        if (devParts.length > 0) phatTrienLines.push('- ' + devParts.join(', ') + '.');
        if (formData.benhManTinh) phatTrienLines.push(`- B·ªánh m√£n t√≠nh ƒëang ƒëi·ªÅu tr·ªã: ${formData.benhManTinh}`);
        if (phatTrienLines.length > 0) {
          tienCanLines.push('1. Qu√° tr√¨nh ph√°t tri·ªÉn:');
          tienCanLines = tienCanLines.concat(phatTrienLines);
        }

        // 2. B·ªánh s·ª≠
        let benhSuLines = [];
        if (formData.tinhTrangKham === 'chuaKham') {
          benhSuLines.push('- Ch∆∞a kh√°m l·∫ßn n√†o.');
        } else if (formData.tinhTrangKham === 'daKham') {
          let khamParts = [];
          if (formData.tuoiKham) khamParts.push(`L√∫c ${formData.tuoiKham} th√°ng`);
          if (formData.noiKham?.length > 0) khamParts.push(`kh√°m t·∫°i ${formData.noiKham.join(', ')}`);
          if (formData.lyDoKham?.length > 0) khamParts.push(`v√¨ ${formData.lyDoKham.join(', ')}`);
          if (formData.chanDoanTruoc?.length > 0) khamParts.push(`ch·∫©n ƒëo√°n: ${formData.chanDoanTruoc.join(', ')}`);
          if (khamParts.length > 0) benhSuLines.push('- ' + khamParts.join('; ') + '.');
          if (formData.sauKham) {
            let canThiepParts = ['Sau kh√°m: h·ªçc tr∆∞·ªùng h√≤a nh·∫≠p v√† h·ªçc can thi·ªáp'];
            if (formData.gioCanThiep || formData.ngayCanThiep) {
              canThiepParts.push(`t·∫ßn su·∫•t: ${formData.gioCanThiep || '...'} gi·ªù/ng√†y x ${formData.ngayCanThiep || '...'} ng√†y/tu·∫ßn cho ƒë·∫øn hi·ªán t·∫°i`);
            }
            if (formData.tongThoiGianCanThiep) canThiepParts.push(`t·ªïng th·ªùi gian ${formData.tongThoiGianCanThiep} th√°ng`);
            benhSuLines.push('- ' + canThiepParts.join(', ') + '.');
          }
        }
        if (benhSuLines.length > 0) {
          tienCanLines.push('2. B·ªánh s·ª≠:');
          tienCanLines = tienCanLines.concat(benhSuLines);
        }

        // 3. M√¥i tr∆∞·ªùng s·ªëng
        let moiTruongLines = [];
        if (formData.songVoi?.length > 0) moiTruongLines.push(`- B√© ƒëang s·ªëng v·ªõi ${formData.songVoi.join(', ')}.`);
        let screenParts = [];
        if (formData.screenTruocDay) screenParts.push(`tr∆∞·ªõc ƒë√¢y kho·∫£ng ${formData.screenTruocDay} gi·ªù m·ªói ng√†y`);
        if (formData.screenDaNgung) screenParts.push(`ƒë√£ ng·ª´ng ${formData.screenDaNgung} th√°ng nay`);
        if (formData.screenHienTai) screenParts.push(`hi·ªán t·∫°i: ${formData.screenHienTai} gi·ªù m·ªói ng√†y`);
        if (screenParts.length > 0) moiTruongLines.push(`- Th·ªùi gian ti·∫øp x√∫c m√†n h√¨nh: ${screenParts.join('. ')}.`);
        if (moiTruongLines.length > 0) {
          tienCanLines.push('3. M√¥i tr∆∞·ªùng s·ªëng:');
          tienCanLines = tienCanLines.concat(moiTruongLines);
        }

        // 4. Lo l·∫Øng
        let loLangLines = [];
        if (formData.loLang?.length > 0) {
          formData.loLang.forEach(item => loLangLines.push(`- ${item}`));
        }
        if (formData.loLangKhac) loLangLines.push(`- ${formData.loLangKhac}`);
        if (loLangLines.length > 0) {
          tienCanLines.push('4. C√°c lo l·∫Øng hi·ªán t·∫°i c·ªßa ph·ª• huynh:');
          tienCanLines = tienCanLines.concat(loLangLines);
        }

        // 5. Ph·ªèng v·∫•n th√™m
        let phongVanLines = [];
        // a
        let aLines = [];
        if (formData.pvDapUngTen) aLines.push(`ƒê√°p ·ª©ng t√™n g·ªçi: ${formData.pvDapUngTen}`);
        if (formData.pvTuongTac) aLines.push(`Kh·ªüi ƒë·∫ßu t∆∞∆°ng t√°c: ${formData.pvTuongTac}`);
        if (formData.pvKhoe) aLines.push(`Khoe v√† g√¢y ch√∫ √Ω: ${formData.pvKhoe}`);
        if (formData.pvCuoiXaHoi) aLines.push(`C∆∞·ªùi x√£ h·ªôi: ${formData.pvCuoiXaHoi}`);
        if (aLines.length > 0) {
          phongVanLines.push('a. T∆∞∆°ng t√°c x√£ h·ªôi - c·∫£m x√∫c');
          aLines.forEach(l => phongVanLines.push(`- ${l}`));
        }
        // b
        let bLines = [];
        if (formData.pvGiaoTiepMat) bLines.push(`Giao ti·∫øp b·∫±ng m·∫Øt/c·ª≠ ch·ªâ: ${formData.pvGiaoTiepMat}`);
        if (formData.pvBieuCam) bLines.push(`Bi·ªÉu c·∫£m khu√¥n m·∫∑t: ${formData.pvBieuCam}`);
        if (formData.pvNhanBieuCam) bLines.push(`Nh·∫≠n ra bi·ªÉu c·∫£m ng∆∞·ªùi kh√°c: ${formData.pvNhanBieuCam}`);
        if (bLines.length > 0) {
          phongVanLines.push('b. H√†nh vi giao ti·∫øp phi ng√¥n ng·ªØ');
          bLines.forEach(l => phongVanLines.push(`- ${l}`));
        }
        // c
        let cLines = [];
        if (formData.pvChoiVoiNguoiKhac) cLines.push(`Quan t√¢m ch∆°i v·ªõi ng∆∞·ªùi kh√°c: ${formData.pvChoiVoiNguoiKhac}`);
        if (formData.pvTroChoiNhom) cLines.push(`Tham gia tr√≤ ch∆°i nh√≥m/gi·∫£ t∆∞·ªüng: ${formData.pvTroChoiNhom}`);
        if (formData.pvChoiMotMinh) cLines.push(`ƒêi·ªÅu ch·ªânh h√†nh vi theo b·ªëi c·∫£nh: ${formData.pvChoiMotMinh}`);
        if (cLines.length > 0) {
          phongVanLines.push('c. Ph√°t tri·ªÉn, duy tr√¨ v√† hi·ªÉu m·ªëi quan h·ªá');
          cLines.forEach(l => phongVanLines.push(`- ${l}`));
        }
        // d - tr√™n m·ªôt d√≤ng, d√πng d·∫•u ph·∫©y
        if (formData.hanhViLapLai?.length > 0) {
          phongVanLines.push(`d. H√†nh vi l·∫∑p l·∫°i: ${formData.hanhViLapLai.join(', ')}`);
        }
        // e - tr√™n m·ªôt d√≤ng, d√πng d·∫•u ph·∫©y
        if (formData.bamViuThoiQuen?.length > 0) {
          phongVanLines.push(`e. B√°m v√≠u th√≥i quen: ${formData.bamViuThoiQuen.join(', ')}`);
        }
        // f
        let fParts = [];
        if (formData.soThichHanChe?.length > 0) fParts = fParts.concat(formData.soThichHanChe);
        if (formData.soThichKhac) fParts.push(formData.soThichKhac);
        if (fParts.length > 0) {
          phongVanLines.push('f. S·ªü th√≠ch h·∫°n ch·∫ø');
          phongVanLines.push(`- ${fParts.join(', ')}`);
        }
        // g
        if (formData.phanUngGiacQuan?.length > 0) {
          phongVanLines.push('g. Ph·∫£n ·ª©ng gi√°c quan');
          phongVanLines.push(`- ${formData.phanUngGiacQuan.join(', ')}.`);
        }
        if (phongVanLines.length > 0) {
          tienCanLines.push('5. Ph·ªèng v·∫•n th√™m:');
          tienCanLines = tienCanLines.concat(phongVanLines);
        }

        if (tienCanLines.length > 0) {
          hasTienCan = true;
          lines.push('TI·ªÄN CƒÇN');
          lines = lines.concat(tienCanLines);
        }

        // ============ KH√ÅM ============
        let khamLines = [];
        
        // 1. Tr·∫ª ch∆°i t·ª± do
        let choiTuDoLines = [];
        if (formData.nepVao) choiTuDoLines.push('- N√©p v√†o/n√∫p sau l∆∞ng ng∆∞·ªùi chƒÉm s√≥c, v·∫ª nh√∫t nh√°t.');
        if (formData.danhGiaKhiTuChoi) choiTuDoLines.push(`- ƒê√°nh gi√° khi t·ª± ch∆°i: ${formData.danhGiaKhiTuChoi}`);
        if (formData.hanhViKham?.length > 0) choiTuDoLines.push(`- H√†nh vi: ${formData.hanhViKham.join(', ')}`);
        if (formData.choiDoChoiKham?.length > 0) choiTuDoLines.push(`- Ch∆°i ƒë·ªì ch∆°i kh√¥ng ƒë√∫ng ch·ª©c nƒÉng: ${formData.choiDoChoiKham.join(', ')}`);
        if (formData.chuDongTuongTacKham) choiTuDoLines.push(`- T∆∞∆°ng t√°c: ${formData.chuDongTuongTacKham}`);
        if (choiTuDoLines.length > 0) {
          khamLines.push('1. Tr·∫ª ch∆°i t·ª± do');
          khamLines = khamLines.concat(choiTuDoLines);
        }

        // 2. T∆∞∆°ng t√°c v·ªõi tr·∫ª
        let tuongTacLines = [];
        // a
        let kaLines = [];
        if (formData.khamDapUngTen) kaLines.push(`ƒê√°p ·ª©ng t√™n g·ªçi: ${formData.khamDapUngTen}`);
        if (formData.khamTheHienCamXuc) kaLines.push(`Th·ªÉ hi·ªán c·∫£m x√∫c: ${formData.khamTheHienCamXuc}`);
        if (formData.khamTuongTacNguoiKham) kaLines.push(`T∆∞∆°ng t√°c v·ªõi ng∆∞·ªùi kh√°m: ${formData.khamTuongTacNguoiKham}`);
        if (kaLines.length > 0) {
          tuongTacLines.push('a. T∆∞∆°ng t√°c x√£ h·ªôi - c·∫£m x√∫c');
          kaLines.forEach(l => tuongTacLines.push(`- ${l}`));
        }
        // b
        let kbParts = [];
        if (formData.khamTiepXucMat) kbParts.push(`Ti·∫øp x√∫c m·∫Øt v·ªõi ng∆∞·ªùi kh√°m: ${formData.khamTiepXucMat}`);
        if (formData.khamChiNgonTro) kbParts.push(`Ch·ªâ b·∫±ng ng√≥n tr·ªè: ${formData.khamChiNgonTro}`);
        if (formData.khamChuYChung) kbParts.push(`Kh·∫£ nƒÉng ch√∫ √Ω chung: ${formData.khamChuYChung}`);
        if (kbParts.length > 0 || formData.khamBieuCam) {
          tuongTacLines.push('b. H√†nh vi giao ti·∫øp phi ng√¥n ng·ªØ');
          if (kbParts.length > 0) tuongTacLines.push(`- ${kbParts.join('; ')}`);
          if (formData.khamBieuCam) tuongTacLines.push(`- Bi·ªÉu c·∫£m khu√¥n m·∫∑t: ${formData.khamBieuCam}`);
        }
        // c
        let kcLines = [];
        if (formData.khamHopTac) kcLines.push(`H·ª£p t√°c trong tr√≤ ch∆°i: ${formData.khamHopTac}`);
        if (formData.khamChoiGiaBo) kcLines.push(`Ch∆°i gi·∫£ b·ªô: ${formData.khamChoiGiaBo}`);
        if (formData.khamSayMeChoi) kcLines.push(`Ch∆°i c√πng ng∆∞·ªùi kh√°m: ${formData.khamSayMeChoi}`);
        if (kcLines.length > 0) {
          tuongTacLines.push('c. Ph√°t tri·ªÉn, duy tr√¨ v√† hi·ªÉu m·ªëi quan h·ªá');
          kcLines.forEach(l => tuongTacLines.push(`- ${l}`));
        }
        // d - tr√™n m·ªôt d√≤ng
        let kdParts = [];
        if (formData.khamHanhViBatThuong?.length > 0) kdParts = formData.khamHanhViBatThuong;
        if (kdParts.length > 0) {
          tuongTacLines.push(`d. H√†nh vi b·∫•t th∆∞·ªùng: tr·∫ª ${kdParts.join(', ')}.`);
        }
        if (formData.khamKhongBatThuong) {
          if (kdParts.length === 0) tuongTacLines.push('d. H√†nh vi b·∫•t th∆∞·ªùng:');
          tuongTacLines.push('- Ng∆∞·ªùi kh√°m kh√¥ng quan s√°t th·∫•y tr·∫ª c√≥ h√†nh vi b·∫•t th∆∞·ªùng trong qu√° tr√¨nh ƒë√°nh gi√°.');
        }
        // e - collapsible
        if (formData.openDanhGiaTapTrung) {
          let keLines = [];
          if (formData.danhGiaMonAn) keLines.push(`Tr·∫ª tr·∫£ l·ªùi ƒë∆∞·ª£c c√°c m√≥n ƒë√£ ƒÉn v√†o t·ªëi h√¥m tr∆∞·ªõc: ${formData.danhGiaMonAn}`);
          if (formData.danhGiaGesell) keLines.push(`Gesell 3 b∆∞·ªõc: ${formData.danhGiaGesell}`);
          if (formData.danhGiaNho3Vat) keLines.push(`Nh·ªõ 3 v·∫≠t sau 5 ph√∫t: ${formData.danhGiaNho3Vat}`);
          if (formData.danhGiaPhepTru) keLines.push(`Th·ª±c hi·ªán ph√©p tr·ª´ 100-7-7-7-7: ${formData.danhGiaPhepTru}`);
          if (formData.lapLaiSo) keLines.push(`L·∫∑p l·∫°i ƒë∆∞·ª£c ${formData.lapLaiSo} s·ªë`);
          if (formData.daoSo) keLines.push(`ƒê·∫£o ƒë∆∞·ª£c ${formData.daoSo} s·ªë`);
          if (keLines.length > 0) {
            tuongTacLines.push('e. ƒê√°nh gi√° v·ªÅ m·ª©c ƒë·ªô t·∫≠p trung');
            keLines.forEach(l => tuongTacLines.push(`- ${l}`));
          }
        }
        // f - collapsible
        if (formData.openDanhGiaMocPhatTrien) {
          let kfLines = [];
          let mocPTParts = [];
          if (formData.vanDongTho) mocPTParts.push(`V·∫≠n ƒë·ªông th√¥: ${formData.vanDongTho} th√°ng`);
          if (formData.ngonNguHieu) mocPTParts.push(`Ng√¥n ng·ªØ hi·ªÉu: ${formData.ngonNguHieu} th√°ng`);
          if (formData.ngonNguDienDat) mocPTParts.push(`Ng√¥n ng·ªØ di·ªÖn ƒë·∫°t: ${formData.ngonNguDienDat} th√°ng`);
          if (formData.giaiQuyetVanDe) mocPTParts.push(`Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ: ${formData.giaiQuyetVanDe} th√°ng`);
          if (formData.xaHoi) mocPTParts.push(`X√£ h·ªôi: ${formData.xaHoi} th√°ng`);
          if (mocPTParts.length > 0) kfLines.push(`* ƒê√°nh gi√° nhanh c√°c lƒ©nh v·ª±c ph√°t tri·ªÉn: ${mocPTParts.join('; ')}`);
          if (formData.thoaiLuiKyNang || formData.thoaiLuiLuc) kfLines.push(`* Tho√°i l√πi k·ªπ nƒÉng: ${formData.thoaiLuiKyNang || '...'} l√∫c ${formData.thoaiLuiLuc || '...'} th√°ng.`);
          
          let caputeParts = [];
          if (formData.tuoiTranR) caputeParts.push(`Tu·ªïi tr·∫ßn ng√¥n ng·ªØ c·∫£m nh·∫≠n (R) = ${formData.tuoiTranR} th√°ng`);
          if (formData.tuoiTranE) caputeParts.push(`Tu·ªïi tr·∫ßn ng√¥n ng·ªØ di·ªÖn ƒë·∫°t (E) = ${formData.tuoiTranE} th√°ng`);
          if (formData.clams) caputeParts.push(`ƒêi·ªÉm ng√¥n ng·ªØ (CLAMS) = ${formData.clams} th√°ng`);
          if (formData.cat) caputeParts.push(`ƒêi·ªÉm nh·∫≠n th·ª©c (CAT) = ${formData.cat} th√°ng`);
          if (formData.tuoiThang && formData.clams) caputeParts.push(`CLAMS DQ = ${formData.clams}/${formData.tuoiThang} x 100 = ${caputeScores.clamsDQ}%`);
          if (formData.tuoiThang && formData.cat) caputeParts.push(`CAT DQ = ${formData.cat}/${formData.tuoiThang} x 100 = ${caputeScores.catDQ}%`);
          if (formData.tuoiThang && formData.clams && formData.cat) caputeParts.push(`Full Scale DQ = (${caputeScores.clamsDQ} + ${caputeScores.catDQ})/2 = ${caputeScores.fullScaleDQ}%`);
          if (caputeParts.length > 0) {
            kfLines.push('* ƒê√°nh gi√° theo thang Capute:');
            caputeParts.forEach(p => kfLines.push(`   - ${p}`));
          }
          if (kfLines.length > 0) {
            tuongTacLines.push('f. Ng∆∞·ªùi kh√°m ƒë√°nh gi√° c√°c m·ªëc ph√°t tri·ªÉn c·ªßa tr·∫ª');
            tuongTacLines = tuongTacLines.concat(kfLines);
          }
        }

        if (tuongTacLines.length > 0) {
          khamLines.push('2. T∆∞∆°ng t√°c v·ªõi tr·∫ª');
          khamLines = khamLines.concat(tuongTacLines);
        }

        if (khamLines.length > 0) {
          hasKham = true;
          if (hasTienCan) lines.push('');
          lines.push('KH√ÅM');
          lines = lines.concat(khamLines);
        }

        // ============ K·∫æT QU·∫¢ CH·ªà ƒê·ªäNH ============
        let chiDinhLines = [];
        if (formData.openADHDPH && (formData.adhdPHKemTapTrung || formData.adhdPHTangDong || formData.adhdPHAnhHuong)) {
          chiDinhLines.push('1. Phi·∫øu ADHD ph·ª• huynh:');
          if (formData.adhdPHKemTapTrung) chiDinhLines.push(`- Bi·ªÉu hi·ªán k√©m t·∫≠p trung = ${formData.adhdPHKemTapTrung}/9`);
          if (formData.adhdPHTangDong) chiDinhLines.push(`- Bi·ªÉu hi·ªán tƒÉng ƒë·ªông = ${formData.adhdPHTangDong}/9`);
          if (formData.adhdPHAnhHuong) chiDinhLines.push(`- ·∫¢nh h∆∞·ªüng ch·ª©c nƒÉng: ${formData.adhdPHAnhHuong}`);
        }
        if (formData.openADHDGV && (formData.adhdGVKemTapTrung || formData.adhdGVTangDong || formData.adhdGVAnhHuong)) {
          chiDinhLines.push('2. Phi·∫øu ADHD gi√°o vi√™n:');
          if (formData.adhdGVKemTapTrung) chiDinhLines.push(`- Bi·ªÉu hi·ªán k√©m t·∫≠p trung = ${formData.adhdGVKemTapTrung}/9`);
          if (formData.adhdGVTangDong) chiDinhLines.push(`- Bi·ªÉu hi·ªán tƒÉng ƒë·ªông = ${formData.adhdGVTangDong}/9`);
          if (formData.adhdGVAnhHuong) chiDinhLines.push(`- ·∫¢nh h∆∞·ªüng ch·ª©c nƒÉng: ${formData.adhdGVAnhHuong}`);
        }
        if (formData.openNEMI) {
          let nemiHasContent = formData.nemiNgayLam || formData.nemiNguoiLam || formData.nemiThaiDo || formData.nemiHieuBiet || formData.nemiIQ;
          if (nemiHasContent) {
            chiDinhLines.push('Tr·∫Øc nghi·ªám tr√≠ tu·ªá NEMI 2.');
            if (formData.nemiNgayLam) chiDinhLines.push(`Ng√†y l√†m tr·∫Øc nghi·ªám: ${formData.nemiNgayLam}`);
            if (formData.nemiNguoiLam) chiDinhLines.push(`Ng∆∞·ªùi l√†m tr·∫Øc nghi·ªám: CVTL. ${formData.nemiNguoiLam}`);
            if (formData.nemiThaiDo) chiDinhLines.push(`Th√°i ƒë·ªô khi l√†m tr·∫Øc nghi·ªám: ${formData.nemiThaiDo}`);
            let hasKetQua = formData.nemiHieuBiet || formData.nemiPhanTich || formData.nemiTuDuy || formData.nemiNgonNgu;
            if (hasKetQua) {
              chiDinhLines.push('K·∫øt qu·∫£ tr·∫Øc nghi·ªám:');
              if (formData.nemiHieuBiet) chiDinhLines.push(`a. Hi·ªÉu bi·∫øt t·ªïng qu√°t ·ªü m·ª©c ƒë·ªô: ${formData.nemiHieuBiet} so v·ªõi y√™u c·∫ßu c·ªßa l·ª©a tu·ªïi, tu·ªïi t∆∞∆°ng ƒë∆∞∆°ng: ${formData.nemiHieuBietTuoi || '...'} tu·ªïi.`);
              if (formData.nemiPhanTich) chiDinhLines.push(`b. Kh·∫£ nƒÉng ph√¢n t√≠ch, kh√°i qu√°t v·∫•n ƒë·ªÅ ·ªü m·ª©c ƒë·ªô: ${formData.nemiPhanTich} so v·ªõi y√™u c·∫ßu c·ªßa l·ª©a tu·ªïi, tu·ªïi t∆∞∆°ng ƒë∆∞∆°ng: ${formData.nemiPhanTichTuoi || '...'} tu·ªïi.`);
              if (formData.nemiTuDuy) chiDinhLines.push(`c. T∆∞ duy logic ·ªü m·ª©c ƒë·ªô: ${formData.nemiTuDuy} so v·ªõi y√™u c·∫ßu c·ªßa l·ª©a tu·ªïi, tu·ªïi t∆∞∆°ng ƒë∆∞∆°ng: ${formData.nemiTuDuyTuoi || '...'} tu·ªïi.`);
              if (formData.nemiNgonNgu) chiDinhLines.push(`d. Ng√¥n ng·ªØ ·ªü m·ª©c ƒë·ªô: ${formData.nemiNgonNgu} so v·ªõi y√™u c·∫ßu c·ªßa l·ª©a tu·ªïi, tu·ªïi t∆∞∆°ng ƒë∆∞∆°ng: ${formData.nemiNgonNguTuoi || '...'} tu·ªïi.`);
            }
            if (formData.nemiIQ || formData.nemiKetLuan) {
              chiDinhLines.push('K·∫øt lu·∫≠n:');
              if (formData.nemiIQ) chiDinhLines.push(`Ch·ªâ s·ªë th√¥ng minh hi·ªán nay: IQ = ${formData.nemiIQ}`);
              chiDinhLines.push('(Ch·ªâ s·ªë th√¥ng minh trung b√¨nh l√† 85-115)');
              if (formData.nemiKetLuan) chiDinhLines.push(`NƒÉng l·ª±c tr√≠ tu·ªá ·ªü m·ª©c ${formData.nemiKetLuan} so v·ªõi tu·ªïi.`);
            }
          }
        }
        if (formData.openWISC) {
          let wiscHasContent = formData.wiscNgayLam || formData.wiscNguoiLam || formData.wiscThaiDo || formData.wiscNgonNgu || formData.wiscIQ;
          if (wiscHasContent) {
            chiDinhLines.push('Tr·∫Øc nghi·ªám tr√≠ tu·ªá WISC IV');
            if (formData.wiscNgayLam) chiDinhLines.push(`Ng√†y l√†m tr·∫Øc nghi·ªám: ${formData.wiscNgayLam}`);
            if (formData.wiscNguoiLam) chiDinhLines.push(`Ng∆∞·ªùi l√†m tr·∫Øc nghi·ªám: CVTL. ${formData.wiscNguoiLam}`);
            if (formData.wiscThaiDo) chiDinhLines.push(`Th√°i ƒë·ªô khi l√†m tr·∫Øc nghi·ªám: ${formData.wiscThaiDo}`);
            let hasKetQua = formData.wiscNgonNgu || formData.wiscTriGiac || formData.wiscTriNho || formData.wiscTocDo;
            if (hasKetQua) {
              chiDinhLines.push('K·∫øt qu·∫£ tr·∫Øc nghi·ªám:');
              if (formData.wiscNgonNgu) chiDinhLines.push(`a. T∆∞ duy ng√¥n ng·ªØ: Lƒ©nh v·ª±c n√†y, tr·∫ª th·ªÉ hi·ªán ·ªü m·ª©c: ${formData.wiscNgonNgu}. Ch·ªâ s·ªë l√† ${formData.wiscNgonNguCS || '...'}`);
              if (formData.wiscTriGiac) chiDinhLines.push(`b. T∆∞ duy tri gi√°c: Lƒ©nh v·ª±c n√†y, tr·∫ª th·ªÉ hi·ªán ·ªü m·ª©c: ${formData.wiscTriGiac}. Ch·ªâ s·ªë l√† ${formData.wiscTriGiacCS || '...'}`);
              if (formData.wiscTriNho) chiDinhLines.push(`c. Tr√≠ nh·ªõ c√¥ng vi·ªác: Lƒ©nh v·ª±c n√†y, tr·∫ª th·ªÉ hi·ªán ·ªü m·ª©c: ${formData.wiscTriNho}. Ch·ªâ s·ªë l√† ${formData.wiscTriNhoCS || '...'}`);
              if (formData.wiscTocDo) chiDinhLines.push(`d. T·ªëc ƒë·ªô x·ª≠ l√Ω: Lƒ©nh v·ª±c n√†y, tr·∫ª th·ªÉ hi·ªán ·ªü m·ª©c: ${formData.wiscTocDo}. Ch·ªâ s·ªë l√† ${formData.wiscTocDoCS || '...'}`);
            }
            if (formData.wiscIQ || formData.wiscKetLuan) {
              chiDinhLines.push('K·∫øt lu·∫≠n:');
              if (formData.wiscIQ) chiDinhLines.push(`Ch·ªâ s·ªë th√¥ng minh: IQ = ${formData.wiscIQ}`);
              chiDinhLines.push('(Ch·ªâ s·ªë th√¥ng minh trung b√¨nh l√† 85-115)');
              if (formData.wiscKetLuan) chiDinhLines.push(`NƒÉng l·ª±c tr√≠ tu·ªá ·ªü m·ª©c ${formData.wiscKetLuan}.`);
            }
          }
        }
        if (chiDinhLines.length > 0) {
          hasChiDinh = true;
          if (hasTienCan || hasKham) lines.push('');
          lines.push('K·∫æT QU·∫¢ CH·ªà ƒê·ªäNH');
          lines = lines.concat(chiDinhLines);
        }

        // ============ CH·∫®N ƒêO√ÅN ============
        let chanDoanLines = [];
        if (formData.chanDoan?.length > 0) chanDoanLines.push(formData.chanDoan.join(' + '));
        if (formData.chanDoanKhac) chanDoanLines.push(formData.chanDoanKhac);
        if (chanDoanLines.length > 0) {
          hasChanDoan = true;
          if (hasTienCan || hasKham || hasChiDinh) lines.push('');
          lines.push('CH·∫®N ƒêO√ÅN');
          lines = lines.concat(chanDoanLines);
        }

        // ============ ƒêI·ªÄU TR·ªä/CAN THI·ªÜP ============
        let dieuTriLines = [];
        if (formData.canThiepHocTap) dieuTriLines.push('- Tr·∫ª c·∫ßn ƒë∆∞·ª£c h·ªçc can thi·ªáp v·ªõi ch∆∞∆°ng tr√¨nh c√° nh√¢n ph√π h·ª£p tu·ªïi ph√°t tri·ªÉn, 1 gi·ªù/ng√†y x 5 ng√†y + h·ªçc h√≤a nh·∫≠p');
        if (formData.huongDanPH?.length > 0) dieuTriLines.push(`- Ph·ª• huynh t∆∞∆°ng t√°c v·ªõi tr·∫ª theo h∆∞·ªõng d·∫´n: ${formData.huongDanPH.join(', ')}`);
        if (formData.taiKham) dieuTriLines.push(`- T√°i kh√°m: ${formData.taiKham}`);
        if (formData.khamThemChuyenKhoa?.length > 0) dieuTriLines.push(`- Kh√°m th√™m chuy√™n khoa: ${formData.khamThemChuyenKhoa.join(', ')}`);
        if (formData.veSinhGiacNgu) dieuTriLines.push('- V·ªá sinh gi·∫•c ng·ªß: 2 ti·∫øng tr∆∞·ªõc khi ƒëi ng·ªß kh√¥ng ƒÉn qu√° no, kh√¥ng ƒë·ªÉ qu√° ƒë√≥i, kh√¥ng xem tivi ƒëi·ªán tho·∫°i, kh√¥ng v·∫≠n ƒë·ªông m·∫°nh.');
        if (formData.photLoHanhVi) dieuTriLines.push('- Ph·ªõt l·ªù c√°c h√†nh vi ƒÉn v·∫°: kh√¥ng nh√¨n, kh√¥ng s·ªù, kh√¥ng n√≥i chuy·ªán, kh√¥ng ƒë√°p ·ª©ng y√™u c·∫ßu v√¥ l√Ω c·ªßa tr·∫ª. C·∫ßn c√≥ s·ª± ƒë·ªìng b·ªô gi·ªØa c√°c th√†nh vi√™n trong gia ƒë√¨nh ƒë·∫∑c bi·ªát l√† √¥ng b√†.');
        if (formData.bangThuong) dieuTriLines.push('- Thi·∫øt l·∫≠p b·∫£ng th∆∞·ªüng; khen nhi·ªÅu h∆°n ch√™.');
        if (formData.chuYDienThoai) dieuTriLines.push('- Ch√∫ √Ω ƒëi·ªán tho·∫°i, nh·∫≠n b·ªánh √°n t√≥m t·∫Øt sau 1 th√°ng qua ƒë∆∞·ªùng b∆∞u ƒëi·ªán. G·ªçi t·ªïng ƒë√†i n·∫øu sau 1 th√°ng ch∆∞a nh·∫≠n ƒë∆∞·ª£c.');
        if (formData.mangTheoCCCD) dieuTriLines.push('- Mang theo cƒÉn c∆∞·ªõc c√¥ng d√¢n ƒë·∫øn qu·∫ßy th√¥ng tin ·ªü t·∫ßng tr·ªát ƒë·ªÉ ƒë∆∞·ª£c h∆∞·ªõng d·∫´n nh·∫≠n b·ªánh √°n t√≥m t·∫Øt sau 3 gi·ªù.');
        if (dieuTriLines.length > 0) {
          hasDieuTri = true;
          if (hasTienCan || hasKham || hasChiDinh || hasChanDoan) lines.push('');
          lines.push('ƒêI·ªÄU TR·ªä/CAN THI·ªÜP');
          lines = lines.concat(dieuTriLines);
        }

        setOutputText(lines.join('\n'));
        setShowOutput(true);
      }, [formData, caputeScores]);

      const copyToClipboard = () => { navigator.clipboard.writeText(outputText); alert('ƒê√£ sao ch√©p!'); };

      const exportToWord = useCallback(async () => {
        const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType } = docx;

        const outputLines = outputText.split('\n');
        const children = [];
        const headings = ['TI·ªÄN CƒÇN', 'KH√ÅM', 'K·∫æT QU·∫¢ CH·ªà ƒê·ªäNH', 'CH·∫®N ƒêO√ÅN', 'ƒêI·ªÄU TR·ªä/CAN THI·ªÜP'];

        outputLines.forEach((line, index) => {
          if (!line.trim()) return; // Skip empty lines

          if (headings.includes(line.trim())) {
            // Main headings - large and bold
            children.push(new Paragraph({
              children: [new TextRun({ text: line, bold: true, size: 32, font: 'Times New Roman' })],
              spacing: { before: 300, after: 150 },
            }));
          } else if (/^\d+\.\s/.test(line)) {
            // Sub-headings (1. 2. 3. etc) - medium bold
            children.push(new Paragraph({
              children: [new TextRun({ text: line, bold: true, size: 26, font: 'Times New Roman' })],
              spacing: { before: 200, after: 100 },
            }));
          } else if (/^[a-g]\.\s/.test(line)) {
            // Sub-sub headings (a. b. c. etc) - small bold
            children.push(new Paragraph({
              children: [new TextRun({ text: line, bold: true, size: 24, font: 'Times New Roman' })],
              spacing: { before: 100, after: 50 },
            }));
          } else if (line.startsWith('- ') || line.startsWith('* ') || line.startsWith('   - ')) {
            // Bullet points
            const indent = line.startsWith('   - ') ? 720 : 360;
            const text = line.replace(/^(\s*[-*]\s)/, '‚Ä¢ ');
            children.push(new Paragraph({
              children: [new TextRun({ text: text.trim(), size: 24, font: 'Times New Roman' })],
              indent: { left: indent },
              spacing: { after: 50 },
            }));
          } else {
            // Regular text
            children.push(new Paragraph({
              children: [new TextRun({ text: line, size: 24, font: 'Times New Roman' })],
              spacing: { after: 50 },
            }));
          }
        });

        const doc = new Document({
          sections: [{
            properties: {
              page: {
                size: { width: 12240, height: 15840 },
                margin: { top: 1440, right: 1440, bottom: 1440, left: 1440 }
              }
            },
            children: children
          }]
        });

        const buffer = await Packer.toBlob(doc);
        const url = window.URL.createObjectURL(buffer);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Ket-qua-tham-kham-${new Date().toISOString().slice(0,10)}.docx`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        window.URL.revokeObjectURL(url);
      }, [outputText]);

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-100 via-teal-50 to-cyan-50">
          <header className="bg-white/95 backdrop-blur-sm shadow-lg border-b border-primary-100 sticky top-0 z-50">
            <div className="max-w-6xl mx-auto px-4 py-4">
              <div className="flex items-center justify-between flex-wrap gap-3">
                <div>
                  <h1 className="text-2xl font-bold text-slate-800 flex items-center gap-3">
                    <svg className="icon-lg text-primary-500" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M2.25 21h19.5m-18-18v18m10.5-18v18m6-13.5V21M6.75 6.75h.75m-.75 3h.75m-.75 3h.75m3-6h.75m-.75 3h.75m-.75 3h.75M6.75 21v-3.375c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21M3 3h12m-.75 4.5H21m-3.75 3.75h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008zm0 3h.008v.008h-.008v-.008z" /></svg>
                    <span>H·ªó tr·ª£ Nh·∫≠p li·ªáu ThƒÉm kh√°m</span>
                  </h1>
                  <p className="text-sm text-slate-500 mt-1 ml-9">Ph√°t tri·ªÉn - H√†nh vi Nhi khoa | v3.4</p>
                </div>
                <div className="flex gap-3">
                  <button onClick={resetForm} className="px-4 py-2.5 bg-red-50 hover:bg-red-100 text-red-600 rounded-xl transition-all duration-200 flex items-center gap-2 font-medium border border-red-200 hover:border-red-300 cursor-pointer">
                    <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" /></svg>
                    T·∫°o m·ªõi
                  </button>
                  <button onClick={generateOutput} className="px-6 py-2.5 bg-gradient-to-r from-primary-500 to-primary-600 hover:from-primary-600 hover:to-primary-700 text-white rounded-xl transition-all duration-200 flex items-center gap-2 font-medium shadow-lg shadow-primary-500/25 cursor-pointer">
                    <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z" /></svg>
                    Xu·∫•t k·∫øt qu·∫£
                  </button>
                </div>
              </div>
            </div>
          </header>
          <div className="bg-white border-b border-slate-200 shadow-sm sticky top-[89px] z-40">
            <div className="max-w-6xl mx-auto px-4">
              <div className="flex">
                {[
                  { id: 'tienCan', label: 'TI·ªÄN CƒÇN', color: '#3b82f6', icon: 'M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z' },
                  { id: 'kham', label: 'KH√ÅM', color: '#22c55e', icon: 'M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z' },
                  { id: 'chiDinh', label: 'CH·ªà ƒê·ªäNH', color: '#f59e0b', icon: 'M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z' },
                  { id: 'ketQuaKham', label: 'K·∫æT QU·∫¢', color: '#a855f7', icon: 'M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z' }
                ].map((tab) => (
                  <button key={tab.id} onClick={() => setActiveMainTab(tab.id)} className={`flex-1 py-4 px-2 font-semibold text-center transition-all duration-200 text-sm sm:text-base flex items-center justify-center gap-2 cursor-pointer ${activeMainTab === tab.id ? 'text-slate-800' : 'text-slate-500 hover:text-slate-700 hover:bg-slate-50'}`} style={{ borderBottomWidth: '3px', borderBottomColor: activeMainTab === tab.id ? tab.color : 'transparent', backgroundColor: activeMainTab === tab.id ? `${tab.color}15` : 'transparent' }}>
                    <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d={tab.icon} /></svg>
                    <span className="hidden sm:inline">{tab.label}</span>
                  </button>
                ))}
              </div>
            </div>
          </div>
          <main className="max-w-6xl mx-auto px-4 py-6">
            {activeMainTab === 'tienCan' && <TienCanTab formData={formData} updateField={updateField} />}
            {activeMainTab === 'kham' && <KhamTab formData={formData} updateField={updateField} caputeScores={caputeScores} />}
            {activeMainTab === 'chiDinh' && <ChiDinhTab formData={formData} updateField={updateField} />}
            {activeMainTab === 'ketQuaKham' && <KetQuaKhamTab formData={formData} updateField={updateField} />}
          </main>
          {showOutput && (
            <div className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in">
              <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate-slide-up">
                <div className="bg-gradient-to-r from-primary-500 to-accent-500 px-6 py-4 flex items-center justify-between">
                  <h2 className="text-xl font-bold text-white flex items-center gap-2">
                    <svg className="icon-lg" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z" /></svg>
                    K·∫øt qu·∫£ ThƒÉm kh√°m
                  </h2>
                  <div className="flex gap-2">
                    <button onClick={copyToClipboard} className="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all duration-200 flex items-center gap-2 cursor-pointer">
                      <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M15.666 3.888A2.25 2.25 0 0013.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 01-.75.75H9a.75.75 0 01-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 01-2.25 2.25H6.75A2.25 2.25 0 014.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 011.927-.184" /></svg>
                      Sao ch√©p
                    </button>
                    <button onClick={exportToWord} className="px-4 py-2 bg-blue-500 hover:bg-blue-600 text-white rounded-lg transition-all duration-200 flex items-center gap-2 cursor-pointer">
                      <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" /></svg>
                      T·∫£i Word
                    </button>
                    <button onClick={() => setShowOutput(false)} className="px-4 py-2 bg-white/20 hover:bg-white/30 text-white rounded-lg transition-all duration-200 flex items-center gap-2 cursor-pointer">
                      <svg className="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                      ƒê√≥ng
                    </button>
                  </div>
                </div>
                <div className="p-6 overflow-y-auto max-h-[calc(90vh-80px)]">
                  <textarea value={outputText} onChange={(e) => setOutputText(e.target.value)} rows={25} className="w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 focus:border-primary-500 outline-none font-mono text-sm bg-slate-50 resize-y transition-all duration-200" />
                </div>
              </div>
            </div>
          )}
          <footer className="bg-white/80 backdrop-blur-sm border-t border-slate-200 mt-8">
            <div className="max-w-6xl mx-auto px-4 py-4 text-center text-sm text-slate-500">
              ·ª®ng d·ª•ng h·ªó tr·ª£ nh·∫≠p li·ªáu thƒÉm kh√°m - Phi√™n b·∫£n 3.4 ‚Ä¢ Ph√°t tri·ªÉn H√†nh vi Nhi khoa
            </div>
          </footer>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<MedicalExamApp />);
  </script>
</body>

</html>
